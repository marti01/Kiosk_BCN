System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder","jimu-arcgis"],(function(e,t){var a={},s={},l={},n={},o={},i={},c={};return{setters:[function(e){a.CONSTANTS=e.CONSTANTS,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.hooks=e.hooks,a.jsx=e.jsx,a.utils=e.utils,a.uuidv1=e.uuidv1},function(e){s.Alert=e.Alert,s.Button=e.Button,s.CollapsablePanel=e.CollapsablePanel,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Label=e.Label,s.Loading=e.Loading,s.MultiSelect=e.MultiSelect,s.NumericInput=e.NumericInput,s.Radio=e.Radio,s.Select=e.Select,s.Switch=e.Switch,s.TextArea=e.TextArea,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.defaultMessages=e.defaultMessages},function(e){l.JimuLayerViewSelector=e.JimuLayerViewSelector,l.MapWidgetSelector=e.MapWidgetSelector,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection,l.SidePopper=e.SidePopper},function(e){n.List=e.List},function(e){o.DataSourceSelector=e.DataSourceSelector},function(e){i.SqlExpressionBuilderPopup=e.SqlExpressionBuilderPopup},function(e){c.JimuMapViewComponent=e.JimuMapViewComponent,c.LayerTypes=e.LayerTypes}],execute:function(){e((()=>{var e={20070:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 3h12v2H2zm0 3v7h12V6zM1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm3 5h2v1H4zm8 0H7v1h5zm-8 2h2v1H4zm8 0H7v1h5z" clip-rule="evenodd"></path></svg>'},748:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.501 3.501 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},41553:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},59788:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},96009:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},34750:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},3185:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},69013:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7.014 7.014 0 0 0 2.256 4h1.6a8.278 8.278 0 0 1 2.103-2.697M3.453 5H1.674a6.958 6.958 0 0 0-.656 2.5H3.01c.04-.89.187-1.725.441-2.5m.56 2.5a8.13 8.13 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.329 9.329 0 0 1-.441-2.5M4.512 11a8.131 8.131 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7.014 7.014 0 0 0 3.702 2.697A8.279 8.279 0 0 1 3.855 12M7.5 14.61V12H4.985c.58 1.011 1.417 1.88 2.515 2.61M7.5 4V1.39C6.402 2.12 5.565 2.99 4.985 4zm2.543 10.697A7.014 7.014 0 0 0 13.745 12h-1.6a8.28 8.28 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.33 9.33 0 0 1-.441 2.5m-.56-2.5a8.132 8.132 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a6.958 6.958 0 0 0-.656-2.5h-1.778c.254.775.401 1.61.441 2.5M11.488 5c.29.764.456 1.597.5 2.5H8.5V5zm.657-1h1.6a7.014 7.014 0 0 0-3.703-2.697c.91.78 1.612 1.68 2.103 2.697M8.5 1.39c1.098.73 1.935 1.6 2.515 2.61H8.5zM8.5 12h2.515c-.58 1.011-1.417 1.88-2.515 2.61z" clip-rule="evenodd"></path></svg>'},79964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},26826:e=>{"use strict";e.exports=c},48891:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=s},338:e=>{"use strict";e.exports=o},77756:e=>{"use strict";e.exports=l},43484:e=>{"use strict";e.exports=i},59587:e=>{"use strict";e.exports=n}},t={};function r(a){var s=t[a];if(void 0!==s)return s.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,r),l.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var u={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(u),r.d(u,{__set_webpack_public_path__:()=>fe,default:()=>ge});var e=r(48891);function t(e){const t=[];e.dataAttributeInfo&&e.dataAttributeInfo.dataSourceItems&&e.dataAttributeInfo.dataSourceItems.length>0&&e.dataAttributeInfo.dataSourceItems.forEach((e=>{const a=e.useDataSource.asMutable();t.push(a)})),e.mapInfo&&e.mapInfo.jimuMapViews&&Object.values(e.mapInfo.jimuMapViews).forEach((e=>{e&&e.length>0&&e.forEach((e=>{const a=e.useDataSource.asMutable();t.push(a)}))})),e.spatialSelection&&e.spatialSelection.useDataSources&&e.spatialSelection.useDataSources.length>0&&e.spatialSelection.useDataSources.forEach((e=>{const a=e.asMutable();t.push(a)}));const a=[],s=[];return t.forEach((e=>{const t=e.dataSourceId;a.includes(t)||(a.push(t),s.push(e))})),s}const a={_widgetLabel:"Select",sourceLabel:"Source",selectByAttrbute:"Select by attributes",newData:"New data",allowGeneratedData:"Allow selection of data generated at runtime",configureLayerAttribute:"Configure layer attribute",labelForAttribution:"Label for attribution",spatialSelection:"Spatial selection",selectByData:"Select by data",addSelectingData:"Add selecting data",selectableLayers:"Selectable layers",noAvailableLayers:"No available layers",interactiveSelection:"Interactive selection",atLeastOneToolTip:"At least one interactive tool is required.",interactiveSelectionMode:"Interactive selection mode",partiallyWithin:"Partially within",whollyWithin:"Wholly within",addAttributionTip:"Add label for attribution",noDataSourceTooltip:"Click the “New data” button to add and configure data sources to be selected."};var s=r(30726),l=r(77756),n=r(59587),o=r(34750),i=r.n(o),c=r(55339),d=r.n(c),p=r(338);const m=(0,e.Immutable)([e.DataSourceTypes.FeatureLayer,e.DataSourceTypes.SceneLayer]);function g(n){const o=n.rootSettingProps,{id:i,config:c}=o,r=e.hooks.useTranslation(s.defaultMessages,a),u=e.React.useCallback((a=>{const s=a&&a[0];if(!s)return;if(c.dataAttributeInfo.dataSourceItems.map((e=>e.useDataSource.mainDataSourceId)).includes(s.mainDataSourceId))return;const l=(0,e.uuidv1)(),r={uid:l,sqlHint:"",useDataSource:s},u=c.dataAttributeInfo.dataSourceItems.concat(r),d=c.setIn(["dataAttributeInfo","dataSourceItems"],u),p=t(d);o.onSettingChange({id:i,config:d,useDataSources:p}),n.onSelectNewDataSourceItem(l)}),[c,n,o,i]);return e.React.createElement(l.SettingSection,{title:r("sourceLabel")},e.React.createElement(l.SettingRow,null,e.React.createElement(p.DataSourceSelector,{widgetId:i,isMultiple:!1,mustUseDataSource:!0,types:m,hideDataView:!0,hideCreateViewButton:!0,onChange:u})))}var f=r(43484);const S=(0,e.Immutable)([e.DataSourceTypes.FeatureLayer,e.DataSourceTypes.SceneLayer]);function b(n){var o,i;const[c,r]=e.React.useState(!1),{rootSettingProps:u,currentDataSourceItem:d}=n,{id:m,config:g}=u,b=e.hooks.useTranslation(s.defaultMessages,a),h=(0,e.Immutable)(d),w=(0,e.Immutable)([d.useDataSource]),v=d.sqlHint||"",x=e.DataSourceManager.getInstance().getDataSource(d.useDataSource.dataSourceId);let y=(null===(o=h.sqlExpression)||void 0===o?void 0:o.displaySQL)||"";h.sqlExpression&&x&&(y=null===(i=e.dataSourceUtils.getArcGISSQL(h.sqlExpression,x))||void 0===i?void 0:i.displaySQL),y=y||"";const j=e.React.useCallback((e=>{const a=g.dataAttributeInfo.dataSourceItems.map((t=>t.uid===d.uid?e:t)),s=g.setIn(["dataAttributeInfo","dataSourceItems"],a),l=t(s);u.onSettingChange({id:m,config:s,useDataSources:l})}),[g,d.uid,u,m]),I=e.React.useCallback((e=>{const t=e&&e[0];if(!t)return;const a=h.set("useDataSource",t).set("sqlExpression",null);j(a)}),[h,j]),R=e.React.useCallback((e=>{const t=e.target.value,a=h.set("sqlHint",t);j(a)}),[h,j]),C=e.React.useCallback((()=>{r(!0)}),[r]),N=e.React.useCallback((()=>{r(!1)}),[r]),M=e.React.useCallback((e=>{const t=h.set("sqlExpression",e);j(t)}),[h,j]);return e.React.createElement("div",null,e.React.createElement(l.SettingSection,{title:b("sourceLabel")},e.React.createElement(l.SettingRow,null,e.React.createElement(p.DataSourceSelector,{widgetId:m,isMultiple:!1,types:S,mustUseDataSource:!0,hideDataView:!0,hideCreateViewButton:!0,useDataSources:w,onChange:I,disableRemove:()=>!0}))),e.React.createElement(l.SettingSection,{title:b("labelForAttribution")},e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextInput,{className:"w-100",size:"sm",value:v,placeholder:b("addAttributionTip"),onChange:R}))),e.React.createElement(l.SettingSection,{title:b("sqlExpr")},e.React.createElement(l.SettingRow,{flow:"wrap",truncateLabel:!0,label:b("addSqlExprForSelection")},e.React.createElement(s.Button,{className:"w-100 text-dark set-link-btn",type:"primary",disabled:!1,onClick:C,title:b("sqlExpressionBuilder")},b("sqlExpressionBuilder"))),e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextArea,{height:80,value:y,spellCheck:!1,readOnly:!0,placeholder:b("addSqlExprFirst"),onClick:e=>{e.currentTarget.select()}})),x&&e.React.createElement(f.SqlExpressionBuilderPopup,{dataSource:x,isOpen:c,toggle:N,expression:h.sqlExpression,onChange:M})))}const h=e.css`width: 184px; padding-right: 16px;`;function w(t){const{enabled:l,titleKey:n,onSwitchChange:o}=t,i=`w-100 d-flex align-items-center ${t.className||""}`,c=e.hooks.useTranslation(s.defaultMessages,a);return(0,e.jsx)("div",{className:i},(0,e.jsx)("div",{className:"text-break text-wrap d-inline",css:h,"aria-label":c(n)},c(n)),(0,e.jsx)("div",{className:"ml-auto"},(0,e.jsx)(s.Switch,{checked:l,onChange:o})))}var v=r(748),x=r.n(v);const y=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:x()},l)):e.React.createElement("svg",Object.assign({className:n},l))},j=e.css`
  flex-direction: column;
  font-size: 0.875rem;
  text-align: center;
  color: var(--dark-500);
  span {
    padding: 0 1rem;
  }
`,I=t=>{const{text:a,style:s}=t;return(0,e.jsx)("div",{css:j,style:s,className:"d-flex align-items-center justify-content-center"},(0,e.jsx)(y,{size:48,color:"var(--dark-200)"}),(0,e.jsx)("span",{className:"mt-4"},a))};function R(e,t){let a=e;if(e&&e.length>0){const s=[];t&&t.length>0&&t.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&s.push(t)}));let l=!1;const n=e.filter((e=>{const t=null==e?void 0:e.useDataSource,a=null==t?void 0:t.dataSourceId,n=a&&s.includes(a);return n||(l=!0),n}));a=l?n:e}return a||(a=e),a}var C,N=r(20070),M=r.n(N);function D(o){const{rootSettingProps:c}=o,{id:r,config:u,useDataSources:p,onSettingChange:m}=c,{dataAttributeInfo:f}=u,S=f.dataSourceItems,h=!!f.allowGenerated,v=e.React.useMemo((()=>R(S,p)),[S,p]),x=(null==v?void 0:v.length)>0,y=e.hooks.useTranslation(s.defaultMessages,a),[j,N]=e.React.useState({}),D=e.React.useRef(null),O=e.React.useRef(null),k=e.React.useRef(null),[E,L]=e.React.useState({status:C.None,currentDataSourceItemUid:null}),A=e.React.useMemo((()=>{let e=null;return E.currentDataSourceItemUid&&(e=S.find((e=>e.uid===E.currentDataSourceItemUid))),e}),[E.currentDataSourceItemUid,S]),T=E.status===C.AddNew,P=E.status===C.ShowDetail&&!!A,V=e.React.useCallback((e=>{e&&N((t=>{const a=e.id;return Object.assign({},t,{[a]:e})}))}),[N]),z=e.React.useCallback((()=>{L({status:C.None,currentDataSourceItemUid:null})}),[L]),B=e.React.useCallback((e=>{L({status:C.ShowDetail,currentDataSourceItemUid:e})}),[L]),q=e.React.useCallback((()=>{L({status:C.AddNew,currentDataSourceItemUid:null})}),[L]),W=e.React.useCallback(((e,t)=>{const a=u.setIn(["dataAttributeInfo","allowGenerated"],t);m({id:r,config:a})}),[u,m,r]),H=e.React.useCallback((e=>{B(e)}),[B]),U=e.React.useCallback((()=>{z()}),[z]),_=e.React.useCallback((()=>{z()}),[z]),F=e.React.useCallback((e=>{A&&A.uid===e&&z();const a=S.filter((t=>t.uid!==e)),s=u.setIn(["dataAttributeInfo","dataSourceItems"],a),l=t(s);m({id:r,config:s,useDataSources:l})}),[u,A,S,m,z,r]),G=[];O.current&&G.push(O.current),k.current&&G.push(k.current);const J=e.React.useCallback((e=>{var t;const a=null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.itemJsons,s=(null==a?void 0:a.length)>0?a[0]:null;if(s){const e=s.itemKey;B(e)}}),[B]),K=e.React.useMemo((()=>{const e=[];return v.forEach((t=>{var a,s;const l=t.useDataSource.dataSourceId,n=!(!A||l!==A.useDataSource.dataSourceId);let o="";const i=j[l];i&&(o=i.getLabel());const c=[{label:y("remove"),iconProps:()=>({icon:d(),size:12}),action:({data:e})=>{const t=null==e?void 0:e.itemJsons,a=(null==t?void 0:t.length)>0?t[0]:null;if(a){const e=a.itemKey;F(e)}}}];(null===(s=null===(a=t.sqlExpression)||void 0===a?void 0:a.parts)||void 0===s?void 0:s.length)>0&&c.unshift({label:"",iconProps:{icon:M(),size:16},action:({data:e})=>{J(null==e?void 0:e.refComponent)}});const r={itemKey:t.uid,itemStateChecked:n,itemStateTitle:o,itemStateCommands:c};e.push(r)})),e}),[A,j,v,F,J,y]);return(0,e.jsx)(e.React.Fragment,null,S.map((t=>{const a=t.useDataSource;return(0,e.jsx)(e.DataSourceComponent,{key:a.dataSourceId,useDataSource:a,onDataSourceCreated:V})})),(0,e.jsx)(l.SettingRow,null,(0,e.jsx)("div",{className:"w-100",ref:O},(0,e.jsx)(s.Button,{className:"w-100 text-dark set-link-btn",onClick:q,type:"primary",ref:D},(0,e.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,e.jsx)(s.Icon,{icon:i(),className:"mr-1",size:14}),y("newData"))))),!x&&(0,e.jsx)(I,{text:y("noDataSourceTooltip"),style:{height:"calc(100% - 15rem)"}}),x&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,{flow:"wrap",label:y("selectableLayers")},(0,e.jsx)(w,{enabled:h,titleKey:"allowGeneratedData",onSwitchChange:W})),(0,e.jsx)(l.SettingRow,null,(0,e.jsx)("div",{className:"w-100",ref:k},(0,e.jsx)(n.List,{dndEnabled:!1,showCheckbox:!1,itemsJson:K,onClickItemBody:(e,t)=>{J(t)}})))),T&&(0,e.jsx)(l.SidePopper,{isOpen:!0,toggle:U,position:"right",trigger:G,title:y("configureLayerAttribute"),backToFocusNode:D.current},(0,e.jsx)(g,{rootSettingProps:c,onSelectNewDataSourceItem:H})),P&&(0,e.jsx)(l.SidePopper,{isOpen:!0,toggle:_,position:"right",trigger:G,title:y("configureLayerAttribute")},(0,e.jsx)(b,{rootSettingProps:c,currentDataSourceItem:A})))}!function(e){e.None="None",e.AddNew="AddNew",e.ShowDetail="ShowDetail"}(C||(C={}));var O=r(26826),k=r(3185),E=r.n(k);const L=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:E()},l)):e.React.createElement("svg",Object.assign({className:n},l))};var A=r(69013),T=r.n(A);const P=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:T()},l)):e.React.createElement("svg",Object.assign({className:n},l))};var V=r(41553),z=r.n(V);const B=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:z()},l)):e.React.createElement("svg",Object.assign({className:n},l))};var q=r(59788),W=r.n(q);const H=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:W()},l)):e.React.createElement("svg",Object.assign({className:n},l))};var U=r(96009),_=r.n(U);const F=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:_()},l)):e.React.createElement("svg",Object.assign({className:n},l))};var G=r(79964),J=r.n(G);const K=t=>{const a=window.SVG,{className:s}=t,l=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(a[s[l]]=e[s[l]])}return a}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:n,src:J()},l)):e.React.createElement("svg",Object.assign({className:n},l))};function Q(t){var n,o;const{jimuMapView:i,currentDataSourceItem:c,onLayerItemDetailUpdate:r}=t,{jimuLayerViewId:u}=c,d=i.jimuLayerViews[u],p=(0,e.Immutable)(c),m=p.sqlHint||"",g=e.hooks.useTranslation(s.defaultMessages,a),[S,b]=e.React.useState(!1),[h,w]=e.React.useState(null);let v=(null===(n=p.sqlExpression)||void 0===n?void 0:n.displaySQL)||"";p.sqlExpression&&h&&(v=null===(o=e.dataSourceUtils.getArcGISSQL(p.sqlExpression,h))||void 0===o?void 0:o.displaySQL),v=v||"",e.React.useEffect((()=>{d&&d.createLayerDataSource().then((e=>{w(e)})).catch((e=>{console.error("LayerItemDetail create data source err",e)}))}),[d]);const x=e.React.useCallback((e=>{const t=e.target.value,a=p.set("sqlHint",t);r(a)}),[p,r]),y=e.React.useCallback((()=>{b(!0)}),[b]),j=e.React.useCallback((()=>{b(!1)}),[b]),I=e.React.useCallback((e=>{const t=p.set("sqlExpression",e);r(t)}),[p,r]);return e.React.createElement("div",null,e.React.createElement(l.SettingSection,{title:g("labelForAttribution")},e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextInput,{className:"w-100",size:"sm",value:m,placeholder:g("addAttributionTip"),onChange:x}))),e.React.createElement(l.SettingSection,{title:g("sqlExpr")},e.React.createElement(l.SettingRow,{flow:"wrap",truncateLabel:!0,label:g("addSqlExprForSelection")},e.React.createElement(s.Button,{className:"w-100 text-dark set-link-btn",type:"primary",disabled:!1,onClick:y,title:g("sqlExpressionBuilder")},g("sqlExpressionBuilder"))),e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextArea,{height:80,value:v,spellCheck:!1,readOnly:!0,placeholder:g("addSqlExprFirst"),onClick:e=>{e.currentTarget.select()}})),h&&e.React.createElement(f.SqlExpressionBuilderPopup,{dataSource:h,isOpen:S,toggle:j,expression:p.sqlExpression,onChange:I})))}var $=function(e,t,a,s){return new(a||(a=Promise))((function(l,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function i(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}c((s=s.apply(e,t||[])).next())}))};const X=e.css`
  .map-layers-header-setting-row.jimu-widget-setting--row-label {
    margin-top: 0 !important;
  }

  .map-layers-header-setting-row {
    width: calc(100% - 22px);
    max-width: calc(100% - 22px);

    .jimu-widget-setting--row-label {
      width: 100%;
      flex-basis: 100%;
      flex-shrink: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .map-title-icon-container {
      flex-wrap: no-wrap;
      flex-shrink: 0;
      flex-grow: 0;

      .setting-loading-container {
        position: relative;
        height: 16px;
        width: 16px;
  
        .donut-loading {
          width: 16px !important;
          height: 16px !important;
          left: 0 !important;
          right: 0 !important;
          top: 0 !important;
          bottom: 0 !important;
        }
      }
    }
  }
`;function Y(t){var o;const{jimuMapView:i,enableAttributeSelection:c,dataSourceItems:r,onDataSourceItemsChange:u}=t,d=e.hooks.useTranslation(s.defaultMessages,a),p=e.DataSourceManager.getInstance().getDataSource(i.dataSourceId),m=(null==p?void 0:p.getLabel())||"",g=i.id,f=e.React.useRef(g);f.current=g;const S="3d"===(null===(o=i.view)||void 0===o?void 0:o.type),[b,h]=e.React.useState(!1),w=!r,v=e.React.useRef(w);v.current=w;const x=e.React.useMemo((()=>(0,e.Immutable)(r||[])),[r]),y=e.React.useMemo((()=>{const e=[];return x.forEach((t=>{e.push(t.jimuLayerViewId)})),e}),[x]),[j,I]=e.React.useState(!1),R=e.React.useRef(null),[C,N]=e.React.useState([]),[D,k]=e.React.useState(""),E=e.React.useMemo((()=>{const e={};return C.forEach((t=>{e[t.id]=!0,t.getAllAncestorJimuLayerViews().forEach((t=>{e[t.id]=!0}))})),e}),[C]),A=e.React.useMemo((()=>D?x.find((e=>e.jimuLayerViewId===D)):null),[D,x]),T=e.React.useCallback((t=>{const a=function(e,t){const a=t.slice();return e&&a.sort(((t,a)=>{const s=ee(e,t),l=ee(e,a);return s&&l?function(e,t){const a=e.split(".").map((e=>parseInt(e))),s=t.split(".").map((e=>parseInt(e)));for(;a.length>0&&s.length>0;){const e=a.shift(),t=s.shift();if(e<t)return-1;if(e>t)return 1}return a.length>0?1:s.length>0?-1:0}(s,l):0})),a}(i,t),s=(0,e.Immutable)(a);u(i.id,s)}),[i,u]),V=e.React.useRef();V.current=T;const[z,q]=e.React.useState(!1),W=e.React.useCallback((e=>{var t;if(c){const a=null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.itemJsons,s=(null==a?void 0:a.length)>0?a[0]:null;if(s){const e=s.itemKey;k(e)}}}),[c]),U=e.React.useMemo((()=>{const e=[];return x.forEach((t=>{var a,s;const{jimuLayerViewId:l,sqlExpression:n}=t;if(!l)return;const o=C.find((e=>e.id===l));if(!o)return;const i=!(!l||l!==D),r=!c,u=(null===(a=o.layer)||void 0===a?void 0:a.title)||"";let d=[];(null===(s=null==n?void 0:n.parts)||void 0===s?void 0:s.length)>0&&(d=[{label:"",iconProps:{icon:M(),size:16},action:({data:e})=>{W(null==e?void 0:e.refComponent)}}]);const p={itemKey:l,itemStateChecked:i,itemStateDisabled:r,itemStateTitle:u,itemStateCommands:d};e.push(p)})),e}),[C,D,c,W,x]);e.React.useEffect((()=>{!function(){$(this,void 0,void 0,(function*(){const e=i.id,t=yield i.whenAllJimuLayerViewLoaded(),a=Object.values(t).filter((e=>!e.fromRuntime&&(e.type===O.LayerTypes.FeatureLayer||e.type===O.LayerTypes.SceneLayer))),s=a.map((e=>e.createLayerDataSource()));try{yield Promise.all(s)}catch(e){console.log(e)}i.isActive||(yield(500,new Promise((e=>{setTimeout((()=>{e()}),500)}))));const l=a.filter((e=>!!e.getLayerDataSource()));if(f.current===e&&(N(l),h(!0),v.current)){const e=l.map((e=>Z(e)));V.current&&V.current(e)}}))}()}),[i]);const _=e.React.useCallback((()=>{I(!0)}),[]),G=e.React.useCallback((()=>{q((e=>!e))}),[]),J=e.React.useCallback((()=>{k("")}),[k]),Y=e.React.useCallback((e=>{const t=x.map((t=>t.jimuLayerViewId===e.jimuLayerViewId?e:t));u(g,t)}),[x,g,u]),te=e.React.useCallback((()=>{I(!1)}),[]),ae=e.React.useCallback((e=>{const t=e.id;return!E[t]}),[E]),se=e.React.useCallback((e=>!C.includes(e)),[C]),le=[];return R.current&&le.push(R.current),(0,e.jsx)("div",{className:"map-layers-setting",css:X},(0,e.jsx)("div",{className:"map-layers-header w-100 d-flex align-items-center mt-4"},S&&(0,e.jsx)(P,{className:"mr-2"}),!S&&(0,e.jsx)(L,{className:"mr-2"}),(0,e.jsx)(l.SettingRow,{flow:"no-wrap",className:"map-layers-header-setting-row w-100",label:m,"aria-label":m},(0,e.jsx)("div",{className:"map-title-icon-container d-flex align-items-center"},!b&&(0,e.jsx)("div",{className:"setting-loading-container"},(0,e.jsx)(s.Loading,{type:"DONUT"})),b&&0===C.length&&(0,e.jsx)(s.Tooltip,{title:d("noAvailableLayers"),showArrow:!1,placement:"top"},(0,e.jsx)("span",null,(0,e.jsx)(s.Button,{className:"border-0",disabled:!b,type:"tertiary",icon:!0,size:"sm"},(0,e.jsx)(K,{size:16,color:"var(--warning-600)"})))),b&&C.length>0&&(0,e.jsx)(s.Tooltip,{title:d("customizeLayers"),showArrow:!1,placement:"top"},(0,e.jsx)("span",null,(0,e.jsx)(s.Button,{ref:R,className:"map-layers-setting-btn mr-1 p-0 border-0",disabled:!b,type:"tertiary",icon:!0,size:"sm",onClick:_},(0,e.jsx)(B,{size:16})))),b&&C.length>0&&(0,e.jsx)(s.Button,{className:"layer-list-toggle-btn p-0 border-0",type:"tertiary",icon:!0,size:"sm",onClick:G},z&&(0,e.jsx)(F,{size:16}),!z&&(0,e.jsx)(H,{size:16}))))),(0,e.jsx)(n.List,{className:(0,e.classNames)(["w-100 mt-1",{"d-none":!z}]),dndEnabled:!1,showCheckbox:!1,itemsJson:U,onClickItemBody:(e,t)=>{W(t)}}),j&&(0,e.jsx)(l.SidePopper,{isOpen:!0,toggle:te,position:"right",trigger:le,title:d("customizeLayers")},(0,e.jsx)(l.SettingRow,{className:"w-100 pl-4 pr-4",label:m,"aria-label":m}),(0,e.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4"},(0,e.jsx)(l.JimuLayerViewSelector,{jimuMapViewId:g,isMultiSelection:!0,defaultSelectedValues:y.slice(),hideLayers:ae,disableLayers:se,onChange:t=>{t=Array.from(new Set(t));const a=C.map((e=>e.id));let{saved:s}=e.utils.diffArrays(!0,a,t);s=Array.from(new Set(s));const l={};x.forEach((e=>{const t=e.jimuLayerViewId;l[t]=e.asMutable()}));const n=[];s.forEach((e=>{let t=l[e];if(!t&&i){const a=i.jimuLayerViews[e];a&&(t=Z(a))}t&&n.push(t)})),T(n)}}))),i&&A&&(0,e.jsx)(l.SidePopper,{isOpen:!0,toggle:J,position:"right",trigger:[],title:d("configureLayerAttribute")},(0,e.jsx)(Q,{jimuMapView:i,currentDataSourceItem:A,onLayerItemDetailUpdate:Y})))}function Z(t){const a=(0,e.uuidv1)(),s=function(e){const t=e.getLayerDataSource(),a=t.id,s=t.getMainDataSource(),l=t.getRootDataSource();return{dataSourceId:a,mainDataSourceId:s?s.id:a,rootDataSourceId:l?l.id:""}}(t);return{uid:a,sqlHint:"",useDataSource:s,sqlExpression:null,jimuLayerViewId:t.id}}function ee(e,t){let a="";if(e&&t){const s=t.jimuLayerViewId;if(s){const t=e.jimuLayerViews[s];t&&(a=t.hierarchyLevel)}}return a}function te(n){const{rootSettingProps:o}=n,{id:i,config:c,useMapWidgetIds:r,onSettingChange:u}=o,{mapInfo:d}=c,p=e.hooks.useTranslation(s.defaultMessages,a),m=r&&r.length>0?r[0]:"",g=!!d.allowGenerated,f=!!d.enableAttributeSelection,[S,b]=e.React.useState([]),h=e.React.useCallback((e=>{e||(e=[]);const t=c.setIn(["mapInfo","jimuMapViews"],{});u({id:i,config:t,useMapWidgetIds:e})}),[c,u,i]),v=e.React.useCallback(((e,t)=>{const a=c.setIn(["mapInfo","allowGenerated"],t);u({id:i,config:a})}),[c,u,i]),x=e.React.useCallback(((e,t)=>{let a=c.mapInfo.set("enableAttributeSelection",t);t||Object.keys(a.jimuMapViews).forEach((e=>{const t=a.jimuMapViews[e].map((e=>e.set("sqlExpression",null)));a=a.setIn(["jimuMapViews",e],t)}));const s=c.set("mapInfo",a);u({id:i,config:s})}),[c,u,i]);e.React.useEffect((()=>{b((e=>e.filter((e=>e.mapWidgetId===m))))}),[m,b]);const y=e.React.useCallback((e=>{const t=Object.values(e).filter((e=>e.dataSourceId&&e.mapWidgetId===m));b(t)}),[m,b]),j=e.React.useCallback(((e,a)=>{const s=c.setIn(["mapInfo","jimuMapViews",e],a),l=t(s);u({id:i,config:s,useDataSources:l})}),[c,u,i]);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,null,(0,e.jsx)(l.MapWidgetSelector,{useMapWidgetIds:r,onSelect:h})),!m&&(0,e.jsx)(I,{text:p("selectMapHint"),style:{height:"calc(100% - 15rem)"}}),m&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,{flow:"wrap",label:p("selectableLayers")},(0,e.jsx)(w,{enabled:g,titleKey:"allowGeneratedData",onSwitchChange:v}),(0,e.jsx)(w,{enabled:f,titleKey:"attributeSelection",className:"mt-3",onSwitchChange:x})),(0,e.jsx)(l.SettingRow,{bottomLine:!0}),(0,e.jsx)(O.JimuMapViewComponent,{useMapWidgetId:m,onViewsCreate:y}),0===S.length&&(0,e.jsx)(s.Alert,{closable:!1,className:"w-100 mt-4",form:"basic",text:p("noWebMapWebSceneTip"),type:"warning",withIcon:!1}),S.map((t=>(0,e.jsx)(Y,{key:t.id,jimuMapView:t,enableAttributeSelection:f,dataSourceItems:d.jimuMapViews[t.id],onDataSourceItemsChange:j})))))}var ae;!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(ae||(ae={})),ae.Intersects,ae.Contains,ae.Crosses,ae.EnvelopeIntersects,ae.IndexIntersects,ae.Overlaps,ae.Touches,ae.Within;const se={[ae.Intersects]:"spatialRelation_Intersect",[ae.Contains]:"spatialRelation_Contain",[ae.Crosses]:"spatialRelation_Cross",[ae.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[ae.IndexIntersects]:"spatialRelation_IndexIntersect",[ae.Overlaps]:"spatialRelation_Overlap",[ae.Touches]:"spatialRelation_Touch",[ae.Within]:"spatialRelation_Within"};var le,ne;function oe(){return{enable:!1,distance:0,unit:le.Meters}}!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(le||(le={})),le.Miles,le.Kilometers,le.Feet,le.Meters,le.NauticalMiles,function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(ne||(ne={}));const ie=e.css`
.select-source-type-radio {
  cursor: pointer;
}

.select-source-type-label {
  cursor: pointer;
  word-break: break-all;
}
`;function ce(t){const{rootSettingProps:n,showPlaceholder:o}=t,{config:i}=n,c=e.hooks.useTranslation(s.defaultMessages,a),r=!i.useMap,u=i.useMap,d=e.React.useCallback((e=>{let t=i.set("useMap",!1);if(!t.dataAttributeInfo){const e={allowGenerated:!1,dataSourceItems:[]};t=t.set("dataAttributeInfo",e)}n.onSettingChange({id:n.id,config:t})}),[i,n]),p=e.React.useCallback((e=>{let t=i.set("useMap",!0);if(!t.mapInfo){const e={allowGenerated:!1,enableAttributeSelection:!1,jimuMapViews:{}};t=t.set("mapInfo",e)}n.onSettingChange({id:n.id,config:t})}),[i,n]),m=o?"h-100":"";return(0,e.jsx)(l.SettingSection,{title:c("sourceLabel"),className:m,css:ie},(0,e.jsx)(l.SettingRow,null,(0,e.jsx)("div",{className:"source-radios"},(0,e.jsx)("div",{className:"source-radio d-flex"},(0,e.jsx)(s.Radio,{id:"select-source-ds-radio",name:"select-source",checked:r,className:"select-source-type-radio",onChange:d}),(0,e.jsx)(s.Label,{for:"select-source-ds-radio",className:"ml-1 select-source-type-label","aria-label":c("selectByAttrbute")},c("selectByAttrbute"))),(0,e.jsx)("div",{className:"source-radio d-flex mt-3"},(0,e.jsx)(s.Radio,{id:"select-source-map-radio",name:"select-source",checked:u,className:"select-source-type-radio",onChange:p}),(0,e.jsx)(s.Label,{for:"select-source-map-radio",className:"ml-1 select-source-type-label","aria-label":c("interactWithMap")},c("interactWithMap"))))),r&&(0,e.jsx)(D,{rootSettingProps:n,showPlaceholder:o}),u&&(0,e.jsx)(te,{rootSettingProps:n,showPlaceholder:o}))}const re=(0,e.Immutable)([e.DataSourceTypes.FeatureLayer,e.DataSourceTypes.SceneLayer]);function ue(t){const{rootSettingProps:n,onSpatialSelectionUpdate:o}=t,{id:i}=n,c=e.hooks.useTranslation(s.defaultMessages,a),r=e.React.useMemo((()=>{let a=t.imSpatialSelection;return a||(a=(0,e.Immutable)(function(){const e=oe();return{enable:!1,useDataSources:[],relationships:[ae.Intersects],buffer:e}}())),a.useDataSources||(a=a.set("useDataSources",[])),a.buffer||(a=a.set("buffer",oe)),a}),[t]);let u=null,d=null,m=!1,g=0,f=null;const S=!!r.enable;if(S){if(u=r.useDataSources,r.relationships){const t=[];r.relationships.forEach((e=>{t.push(e)})),d=(0,e.Immutable)(t)}r.buffer&&(m=!!r.buffer.enable,g=r.buffer.distance,f=r.buffer.unit)}u||(u=(0,e.Immutable)([])),d||(d=(0,e.Immutable)([])),"number"!=typeof g&&(g=0),f||(f=le.Meters);const b=e.React.useMemo((()=>(0,e.Immutable)(Object.entries(ae).map((([e,t])=>({value:t,label:c(se[t])}))))),[c]),h=e.React.useCallback(((e,t)=>{const a=r.set("enable",t);o(a)}),[r,o]),v=e.React.useCallback((t=>{const a=u.map((e=>e.dataSourceId)).asMutable(),s=t.map((e=>e.dataSourceId)),{added:l,deleted:n}=e.utils.diffArrays(!0,a,s),i=[];l.length>0&&0===n.length&&l.forEach((e=>{const a=t.find((t=>t.dataSourceId===e));a&&!a.dataViewId&&i.push(e)}));let c=null;if(i.length>0){const a=e.DataSourceManager.getInstance();c=t.map((t=>{if(i.includes(t.dataSourceId)){const s=Object.assign({},t),l=e.CONSTANTS.SELECTION_DATA_VIEW_ID;return s.dataViewId=l,s.dataSourceId=a.getDataViewDataSourceId(t.mainDataSourceId,l),s}return t}))}else c=t;const d=r.set("useDataSources",c);o(d)}),[r,u,o]),x=e.React.useCallback((e=>c("numSelected",{number:e.length})),[c]),y=e.React.useCallback(((e,t,a)=>{if(0===a.length)return;const s=r.set("relationships",a);o(s)}),[r,o]),j=e.React.useCallback(((e,t)=>{const a=r.setIn(["buffer","enable"],t);o(a)}),[r,o]),I=e.React.useCallback((e=>{const t=r.setIn(["buffer","distance"],e);o(t)}),[r,o]),R=e.React.useCallback((e=>{const t=e.target.value,a=r.setIn(["buffer","unit"],t);o(a)}),[r,o]);return(0,e.jsx)(l.SettingSection,{role:"group","aria-label":c("spatialSelection"),title:""},(0,e.jsx)(s.CollapsablePanel,{label:c("spatialSelection"),level:0,type:"default"},(0,e.jsx)(w,{titleKey:"selectByData",enabled:S,className:"setting-text-level-2 mt-4",onSwitchChange:h}),(0,e.jsx)(s.Collapse,{isOpen:S},(0,e.jsx)(l.SettingRow,{flow:"wrap",truncateLabel:!0,label:"",className:"mt-4"},(0,e.jsx)(p.DataSourceSelector,{buttonLabel:c("addSelectingData"),widgetId:i,types:re,isMultiple:!0,disableDataView:!1,isMultipleDataView:!1,disableDataSourceList:!1,mustUseDataSource:!0,useDataSources:u,onChange:v})),(0,e.jsx)(l.SettingRow,{flow:"wrap",label:c("relationship")},(0,e.jsx)(s.MultiSelect,{"aria-label":c("relationship"),items:b,values:d,fluid:!0,onClickItem:y,displayByValues:x,size:"sm"})),(0,e.jsx)(l.SettingRow,{label:c("enableBuffer")},(0,e.jsx)(s.Switch,{"aria-label":c("enableBuffer"),checked:m,onChange:j})),m&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,{label:c("defaultDistance")},(0,e.jsx)(s.NumericInput,{css:e.css`
                    width: 40%;
                    flex: 0 0 40%;
                    flex-shrink: 0;
                    flex-grow: 0;
                  `,"aria-label":c("defaultDistance"),size:"sm",min:0,value:g,onChange:I})),(0,e.jsx)(l.SettingRow,{label:c("defaultUnit")},(0,e.jsx)(s.Select,{css:e.css`
                    width: 40%;
                    flex: 0 0 40%;
                    flex-shrink: 0;
                    flex-grow: 0;
                  `,size:"sm",value:f,"aria-label":c("defaultUnit"),onChange:R},Object.values(le).map((t=>(0,e.jsx)("option",{key:t,value:t},c(`unit_${t}`))))))))))}const de=e.css`
  .tool-alert-container {
    position: relative;
    min-height: 0.1px;

    .tool-alert {
      position: absolute;
      left: 0;
      top: 0;
      z-index: 1;
    }
  }
`;function pe(t){const{onInteractiveToolSectionUpdate:n}=t,o=e.hooks.useTranslation(s.defaultMessages,a),[i,c]=e.React.useState(!1),r=e.React.useRef(null),u=()=>{r.current&&(clearTimeout(r.current),r.current=null)};e.React.useEffect((()=>()=>{r.current&&(clearTimeout(r.current),r.current=null)}),[]);const d=e.React.useMemo((()=>{let a=t.imInteractiveTools;return a||(a=(0,e.Immutable)({tools:[ne.Rectangle],partiallyWithin:!0})),a.tools||(a=a.set("tools",[ne.Rectangle])),"boolean"!=typeof a.partiallyWithin&&(a=a.set("partiallyWithin",!0)),a}),[t]),p=d.tools,m=e.React.useMemo((()=>[{value:ne.Rectangle,label:o("SelectionByRectangle")},{value:ne.Polygon,label:o("SelectionByLasso")},{value:ne.Circle,label:o("SelectionByCircle")},{value:ne.Polyline,label:o("SelectionByLine")},{value:ne.Point,label:o("SelectionByPoint")}]),[o]),g=e.React.useCallback(((e,t)=>{if(t){const e=d.set("partiallyWithin",!0);n(e)}}),[d,n]),f=e.React.useCallback(((e,t)=>{if(t){const e=d.set("partiallyWithin",!1);n(e)}}),[d,n]);return(0,e.jsx)(l.SettingSection,{role:"group","aria-label":o("interactiveSelection"),title:"",css:de},(0,e.jsx)(s.CollapsablePanel,{label:o("interactiveSelection"),level:0,type:"default"},(0,e.jsx)(l.SettingRow,{flow:"wrap",label:o("tools"),className:"mt-4 mb-0"},m.map((t=>(0,e.jsx)("div",{key:t.value,className:"w-100 d-flex align-items-center pt-3"},(0,e.jsx)("div",{className:"text-break text-wrap d-inline",css:e.css`width: 184px; padding-right: 16px;`},t.label),(0,e.jsx)("div",{className:"ml-auto"},(0,e.jsx)(s.Switch,{checked:p.includes(t.value),onChange:(e,a)=>{((e,t)=>{let a=p.asMutable();if(t)a.includes(e)||a.push(e);else if(a=a.filter((t=>t!==e)),0===a.length)return c(!0),u(),void(r.current=setTimeout((()=>{c(!1)}),5e3));const s=d.set("tools",a);n(s)})(t.value,a)}})))))),(0,e.jsx)("div",{className:"tool-alert-container mt-2 mb-2"},(0,e.jsx)(s.Alert,{closable:!0,className:"tool-alert w-100",form:"basic",onClose:()=>{u(),c(!1)},open:i,text:o("atLeastOneToolTip"),type:"warning",withIcon:!0})),(0,e.jsx)(l.SettingRow,{flow:"wrap",label:o("interactiveSelectionMode"),className:"mb-3"},(0,e.jsx)(s.Label,{className:"w-100 d-flex align-items-center"},(0,e.jsx)(s.Radio,{name:"select-widget-interactive-selection-mode",className:"mr-2",checked:d.partiallyWithin,onChange:g}),o("partiallyWithin")),(0,e.jsx)(s.Label,{className:"w-100 d-flex align-items-center"},(0,e.jsx)(s.Radio,{name:"select-widget-interactive-selection-mode",className:"mr-2",checked:!d.partiallyWithin,onChange:f}),o("whollyWithin")))))}const me=e.css`
`;function ge(a){var s;const{config:l,useMapWidgetIds:n,useDataSources:o}=a,i=e.React.useCallback((e=>{const s=t(e);a.onSettingChange({id:a.id,config:e,useDataSources:s})}),[a]),c=l.useMap,r=null===(s=null==l?void 0:l.dataAttributeInfo)||void 0===s?void 0:s.dataSourceItems,u=e.React.useMemo((()=>R(r,o)),[r,o]),d=(null==u?void 0:u.length)>0,p=n&&n.length>0?n[0]:"",m=c&&p,g=c&&p||!c&&d,f=c&&!p||!c&&!d;return(0,e.jsx)("div",{className:"jimu-widget-setting widget-setting-select",css:me},(0,e.jsx)(ce,{rootSettingProps:a,showPlaceholder:f}),m&&(0,e.jsx)(pe,{rootSettingProps:a,imInteractiveTools:l.interactiveTools,onInteractiveToolSectionUpdate:e=>{const t=l.set("interactiveTools",e);i(t)}}),g&&(0,e.jsx)(ue,{rootSettingProps:a,imSpatialSelection:l.spatialSelection,onSpatialSelectionUpdate:e=>{const t=l.set("spatialSelection",e);i(t)}}))}function fe(e){r.p=e}})(),u})())}}}));