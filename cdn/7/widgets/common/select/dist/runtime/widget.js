System.register(["jimu-core","jimu-ui","jimu-ui/basic/sql-expression-runtime","jimu-arcgis"],(function(e,t){var a={},o={},n={},s={};return{setters:[function(e){a.CONSTANTS=e.CONSTANTS,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceSelectionMode=e.DataSourceSelectionMode,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.QueryScope=e.QueryScope,a.React=e.React,a.ReactDOM=e.ReactDOM,a.SqlExpressionMode=e.SqlExpressionMode,a.appActions=e.appActions,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.moduleLoader=e.moduleLoader,a.observeStore=e.observeStore,a.utils=e.utils,a.uuidv1=e.uuidv1},function(e){o.Button=e.Button,o.Checkbox=e.Checkbox,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Label=e.Label,o.Loading=e.Loading,o.NumericInput=e.NumericInput,o.Popper=e.Popper,o.Progress=e.Progress,o.SVG=e.SVG,o.Select=e.Select,o.Switch=e.Switch,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){n.SqlExpressionRuntime=e.SqlExpressionRuntime,n.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.LayerTypes=e.LayerTypes,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={88970:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 0H6v4.5h1V1h5v5.133l3.638 6.367H11.3v1h8.2zm-2.71 12.5h1.71V7.022l-3.35 2.606zM14.648 8.75 18.5 5.755V1H13v4.867z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M11.89 10.006 1 4.165v12.318l2.897-3.357 3.401 6.517 3.367-1.95-3.426-6.564zM2 13.793V5.837l7.11 3.813-3.35.808 3.575 6.85-1.633.947-3.6-6.897z" clip-rule="evenodd"></path></svg>'},50926:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7 14v-1h2v1zM9 12v-1H7v1zM10 13h4v1h-4zM14 11h-4v1h4z"></path><path fill="#000" fill-rule="evenodd" d="M15 6a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zM6 9V7h9v2zm9 6v-5H6v5zM0 10.5V12a1 1 0 0 0 1 1h1.5v-1H1v-1.5zM2.5 1H1a1 1 0 0 0-1 1v1.5h1V2h1.5zM0 8.5h1v-3H0zM4.5 1v1h3V1zm5 0v1H11v1.5h1V2a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>'},75433:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.95 3a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h3.55a2.5 2.5 0 0 1 4.9 0h6.55a.5.5 0 0 1 0 1zM6.5 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m7.45 4.5a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h8.55a2.5 2.5 0 0 1 4.9 0h1.55a.5.5 0 0 1 0 1zm-2.45 1a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m-7 6.5a2.5 2.5 0 0 0 2.45-2h8.55a.5.5 0 0 0 0-1H6.95a2.5 2.5 0 0 0-4.9 0H.5a.5.5 0 0 0 0 1h1.55a2.5 2.5 0 0 0 2.45 2M3 13.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0" clip-rule="evenodd"></path></svg>'},33869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.522.522 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.508.508 0 0 1-.73 0L1 7.5l4.743-4.846a.508.508 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},31670:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},92912:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},18287:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 5.5C16 2.462 13.456 0 10.318 0 7.933 0 5.828 1.435 5 3.56l.886.323.078-.187c.737-1.667 2.438-2.78 4.354-2.78 2.615 0 4.735 2.053 4.735 4.584 0 2.531-2.12 4.583-4.735 4.583-.98 0-1.915-.288-2.703-.82l-.54.753.22.142a5.796 5.796 0 0 0 3.023.842C13.456 11 16 8.538 16 5.5M.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},46475:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657zM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},35103:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0M.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},36811:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0L6 2.982v2.162h.91l-.001-1.49 8.182-2.44v8.882H8.434V11zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},48682:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0H5v3.5h1V1h9v9H8.5v1zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},80526:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOC44OTIxOSA3Ljk2ODU2TDAuMjUwMDg4IDNMMC4yMzE5MzQgMTIuOTY4NkwyLjU4Mjk3IDEwLjM3NEw1LjMwNjcxIDE1LjgyMzdMOC4xOTM0NiAxNC4xNTdMNS40Njk3MiA4LjcwNzM0TDguODkyMTkgNy45Njg1NlpNMS4yMzYzMyAxMC4zNzAxTDEuMjQ2MzMgNC43MjYwN0w2LjEzOTMzIDcuNTM5MDdMMy45MTgwMyA4LjAxOTE5TDYuODI3MzMgMTMuNzkwMUw1LjY3MjMzIDE0LjQ1NzFMMi43NjMzMyA4LjY4NTg2TDEuMjM2MzMgMTAuMzcwMVoiIGZpbGw9ImJsYWNrIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExIDAuNjg3NUw2IDMuNzgxMjVMMTEgNi44NzVMMTYgMy43ODEyNUwxMSAwLjY4NzVaTTE0LjcyNSA1LjgyNzYxTDE0LjM0NjMgNS41OTMxN0wxNC45ODM3IDUuMTk4NTVMMTYgNS44Mjc2MUwxMSA4LjkyMTM2TDYgNS44Mjc2MUw3LjAxNjg4IDUuMTk4NTVMNy42NTQzOCA1LjU5MzE3TDcuMjc1IDUuODI3NjFMMTEgOC4xMzI4TDE0LjcyNSA1LjgyNzYxWk0xNiA3Ljg5MDNMMTQuOTcwNiA3LjI1Mjk5TDE0LjMzMzEgNy42NDc2MkwxNC43MjUgNy44OTAzTDExIDEwLjE5NTVMNy4yNzUgNy44OTAzTDcuNjY3NSA3LjY0NzYyTDcuMDMgNy4yNTI5OUw2IDcuODkwM0wxMSAxMC45ODQxTDE2IDcuODkwM1pNMTEgMS40NzcwNUw3LjI3NTAyIDMuNzgxNTVMMTEgNi4wODY3NEwxNC43MjUgMy43ODE1NUwxMSAxLjQ3NzA1WiIgZmlsbD0iYmxhY2siLz4NCjwvc3ZnPg0K"},26826:e=>{"use strict";e.exports=s},48891:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=o},15506:e=>{"use strict";e.exports=n}},t={};function i(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var r={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(r),i.d(r,{__set_webpack_public_path__:()=>Te,default:()=>Ee});var e=i(48891),t=i(30726),a=i(88866),o=i.n(a);const n=t=>{const a=window.SVG,{className:n}=t,s=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a}(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:i,src:o()},s)):e.React.createElement("svg",Object.assign({className:i},s))},s={_widgetLabel:"Select",selectByData:"Select by data",selectingFeatures:"Selecting features",bufferUnit:"Buffer unit",selectByLocationFeatureCountTip:"There are {count} features inside this data.",attributeFilterBatchOnTip:"Apply all attribution for active layers",attributeFilterBatchOffTip:"Remove all attribution for active layers",allSelectable:"All selectable",noneSelectable:"None selectable",toggleAll:"Toggle all",buildCustomSQL:"Build custom SQL",customSQL:"Custom SQL",selectWidgetSelection:"{layerName} select widget selection",noLayersAvailableTip:"No layers are available to select.",openSettingPanelTip:"Please open the widget setting panel to update the configurations."};var l;!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(l||(l={}));const c={[l.Intersects]:"esriSpatialRelIntersects",[l.Contains]:"esriSpatialRelContains",[l.Crosses]:"esriSpatialRelCrosses",[l.EnvelopeIntersects]:"esriSpatialRelEnvelopeIntersects",[l.IndexIntersects]:"esriSpatialRelIndexIntersects",[l.Overlaps]:"esriSpatialRelOverlaps",[l.Touches]:"esriSpatialRelTouches",[l.Within]:"esriSpatialRelWithin"},u={[l.Intersects]:"spatialRelation_Intersect",[l.Contains]:"spatialRelation_Contain",[l.Crosses]:"spatialRelation_Cross",[l.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[l.IndexIntersects]:"spatialRelation_IndexIntersect",[l.Overlaps]:"spatialRelation_Overlap",[l.Touches]:"spatialRelation_Touch",[l.Within]:"spatialRelation_Within"};var d;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(d||(d={}));const p={[d.Miles]:"miles",[d.Kilometers]:"kilometers",[d.Feet]:"feet",[d.Meters]:"feet",[d.NauticalMiles]:"nautical-miles"};var m;!function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(m||(m={}));var f,g=i(15506);function S(e,t,a,o){const n={};return a.forEach((a=>{const s=a.uid;if(o[s])return;const i=a.sqlExpression,r=b(t,i),l=j(null),c=M(""),u={uid:s,displayTitle:"",dataSource:null,jimuLayerView:null,isGenerated:t,shouldRenderFilterIcon:r,imDisplaySqlExpression:i,checked:!e,isSelecting:!1,latestSelectTaskInfo:{version:0,selectionMode:null,appliedGeometryInfo:l,appliedSql:c},isAttributeFilterOn:!1,tryExecuteSelectingByGeometryInfoAndSqlUI:null,enableAttributeFilter:null,clearSelection:null};n[s]=u})),n}function y(t,a){const o=(0,e.uuidv1)(),n=t.id;let s=n;const i=t.getMainDataSource();i&&(s=i.id);const r={uid:o,sqlHint:"",sqlExpression:null,useDataSource:{dataSourceId:n,mainDataSourceId:s},jimuLayerViewId:a};return(0,e.Immutable)(r)}function v(e,t){const a=function(e,t){const a=[];return e.forEach((e=>{const o=e.uid,n=t[o];n&&a.push({dataSourceItem:e,runtimeInfo:n})})),a}(e,t),o=[];return a.forEach((e=>{const{dataSourceItem:t,runtimeInfo:a}=e;t&&a&&a.displayTitle&&(t.jimuLayerViewId?a.jimuLayerView&&o.push(a):a.dataSource&&o.push(a))})),o}function h(e,t){return v(e,t).filter((e=>e.checked))}function w(e,t){return v(e,t).filter((e=>e.checked&&!e.isSelecting))}function b(e,t){let a=!1;return e?a=!0:t&&(a=!!M(t.sql)||I(e,t)),a}function I(e,t){let a=!1;return!e&&t&&(a=(0,g.getShownClauseNumberByExpression)(t)>0),a}function x(t,a,o){let n="";if(t&&a&&o){const t=e.dataSourceUtils.getArcGISSQL(a,o);t&&(n=t.sql)}return M(n)}function R(e){return"number"==typeof e&&e>0}function M(e){let t=e||"";return"1=1"===t&&(t=""),t}function j(e){return void 0===e?null:e}!function(e){e.Placeholder="Placeholder",e.Loading="Loading",e.NoLayersTip="NoLayersTip",e.Normal="Normal"}(f||(f={}));var D=i(48682),N=i.n(D),k=i(36811),C=i.n(k),L=i(18287),E=i.n(L),T=i(46475),O=i.n(T),A=i(35103),V=i.n(A),z=i(80526),P=i.n(z),B=function(e,t,a,o){return new(a||(a=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};const F=e.css`
  overflow: hidden;
  border-bottom: 1px solid var(--light-300);

  .dropdown-btn-container {
    position: relative;
    overflow: hidden;
    float: left;

    .api-modules-loading-progress {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      width: 100%;
      background-color: rgba(110,110,110,0.3);
      animation: esri-fade-in 500ms ease-in-out;
    }

    .api-modules-loading-progress:after {
      position: absolute;
      width: 20%;
      height: 2px;
      top: 0;
      content: "";
      opacity: 1;
      z-index: 0;
      background-color: var(--primary);
      animation: looping-progresss-bar-ani 1500ms linear infinite;
      transition: opacity 500ms ease-in-out;
    }
  }

  .render-dropdown {
    .selected-tool-btn {
      border-right: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .select-dropdown-btn {
      border-left: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
  }

  .clear-all-btn {
    float: right;
  }
`,U="data",G={polygon:{mode:"hybrid"}},q={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},W={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},H={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};function J(a){var o,n,i;const{config:r,widgetId:l,mapWidgetId:c,autoControlWidgetId:u,activeJimuMapView:d,setSelectByLoactionVisible:p,allImDataSourceItems:f,dataSourceItemRuntimeInfoMap:g}=a,{useMap:S,interactiveTools:y,spatialSelection:h}=r,b=null==h?void 0:h.enable,I=e.hooks.useTranslation(t.defaultMessages,s),x=e.React.useRef(!1),[R,M]=e.React.useState(null),j=e.React.useRef(null);j.current=d;const[D,k]=e.React.useState(null),L=e.React.useMemo((()=>(null==D?void 0:D.view)||null),[D]),T=e.React.useRef(null),[A,z]=e.React.useState(!1),[J,Y]=e.React.useState(!1),Z=e.React.useRef([]),Q=e.React.useRef(null),K=e.React.useRef(null),X=e.React.useRef("macOS"===(null===(n=null===(o=window.jimuUA)||void 0===o?void 0:o.os)||void 0===n?void 0:n.name)),ee=!(!R||!L),te=(null===(i=r.mapInfo)||void 0===i?void 0:i.enableAttributeSelection)||!1,ae=e.React.useMemo((()=>{let e="esriSpatialRelIntersects";return y&&!1===y.partiallyWithin&&(e="esriSpatialRelContains"),e}),[y]),oe=e.React.useMemo((()=>v(f,g)),[f,g]),ne=e.React.useMemo((()=>w(f,g)),[f,g]),se=e.React.useMemo((()=>({[m.Rectangle]:{order:1,label:I("SelectionByRectangle"),iconSrc:N()},[m.Polygon]:{order:2,label:I("SelectionByLasso"),iconSrc:C()},[m.Circle]:{order:3,label:I("SelectionByCircle"),iconSrc:E()},[m.Polyline]:{order:4,label:I("SelectionByLine"),iconSrc:O()},[m.Point]:{order:5,label:I("SelectionByPoint"),iconSrc:V()},[U]:{order:6,label:I("selectByData"),iconSrc:P()}})),[I]),ie=e.React.useMemo((()=>{const e=[];return S&&y&&y.tools&&y.tools.length>0&&y.tools.forEach((t=>{e.push(t)})),b&&e.push(U),e.sort(((e,t)=>se[e].order-se[t].order)),e}),[y,b,se,S]),[re,le]=e.React.useState(ie[0]),ce=e.React.useMemo((()=>ie.filter((e=>e!==U)).length>0),[ie]),ue=ce&&!R,de=e.React.useMemo((()=>{let e="";if(re){const t=se[re];t&&(e=t.iconSrc)}return e}),[se,re]),pe=e.React.useCallback((e=>e!==U&&!ee),[ee]),me=e.React.useMemo((()=>{const a=[];return ie.forEach((o=>{o===U&&ie.length>=2&&a.push((0,e.jsx)(t.DropdownItem,{key:"divider",divider:!0}));const n=o===re,s=se[o].iconSrc,i=pe(o),r=(0,e.jsx)(t.DropdownItem,{key:o,active:n,disabled:i,onClick:()=>{le(o)}},(0,e.jsx)(t.SVG,{src:s,className:"mr-2"}),se[o].label);a.push(r)})),a}),[ie,re,se,pe]);e.React.useEffect((()=>{const e=X.current,t=t=>{"Shift"===t.key?Q.current={eventDate:new Date,isKeyDown:!0}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(K.current={eventDate:new Date,isKeyDown:!0})},a=t=>{"Shift"===t.key?Q.current={eventDate:new Date,isKeyDown:!1}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(K.current={eventDate:new Date,isKeyDown:!1})};return document.addEventListener("keydown",t,!0),document.addEventListener("keyup",a,!0),()=>{document.removeEventListener("keydown",t,!0),document.removeEventListener("keyup",a,!0)}}),[]),e.React.useEffect((()=>{const e=j.current;e&&e!==D&&e.whenJimuMapViewLoaded().then((()=>{e===j.current&&k(e)}))}),[d,D]),e.React.useEffect((()=>{!ce||R||x.current||(x.current=!0,(0,e.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/symbols/support/jsonUtils","esri/geometry/geometryEngine","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then((e=>{const[t,a,o,n]=e;M({SketchViewModel:t,GraphicsLayer:a,jsonUtils:o,geometryEngine:n})})).catch((e=>{console.error("select widget loads api error",e)})))}),[R,x,ce]);const fe=e.React.useMemo((()=>re&&re!==U?re:null),[re]),ge=e.React.useMemo((()=>A&&re&&re!==U?re:null),[A,re]);e.hooks.useEffectWithPreviousValues((t=>{const[a,o]=t;if(l){if(ge!==a&&c)if(ge&&u!==l){const t=e.appActions.requestAutoControlMapWidget(c,l);(0,e.getAppStore)().dispatch(t)}else if(!ge&&u===l){const t=e.appActions.releaseAutoControlMapWidget(c);(0,e.getAppStore)().dispatch(t)}u!==o&&u!==l&&ge&&z(!1)}}),[ge,u,l]),e.React.useEffect((()=>{if(re&&!ie.includes(re)){const e=ie.length>0?ie[0]:null;le(e),z(!1)}else if(!re&&ie.length>0){const e=ie[0];le(e),z(!1)}}),[ie,re]);const Se=!(!S||te||!fe),ye=e.hooks.usePrevious(ge),ve=null==R?void 0:R.geometryEngine,he=e.React.useRef(null),we=e.React.useCallback(((t,a,o)=>{if(!a.geometry)return void console.log("sketch graphic.geometry is null");Se||(o=e.DataSourceSelectionMode.New);let n=a.geometry;try{if("point"===n.type||"polyline"===n.type){const e=10*(null==t?void 0:t.resolution);if(e>0&&ve){const t=ve.buffer(n,e,"meters");t&&(n=t)}}}catch(e){console.error("geometryEngine.buffer() error of Select widget",e)}const s=e.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(n.type),i={geometry:n.toJSON(),geometryType:s,spatialRel:ae};Z.current=ne,(Z.current||[]).forEach((e=>B(this,void 0,void 0,(function*(){e.tryExecuteSelectingByGeometryInfoAndSqlUI(o,i)}))))}),[Se,ae,ne,ve]);he.current=we,e.React.useEffect((()=>{const t=T.current;let a=t;if(t){let e=!1;if(ge)if(ye===ge){const a=L||null,o=t.view||null;e=!a||a!==o}else e=!0;else e=!0;e&&(t&&_(t),a=null)}const o=()=>{const e=T.current;if(e&&ge){const t=G[ge];t?e.create(ge,t):e.create(ge)}};if(R&&L&&ge&&!a){const t=L.on("key-down",(e=>{"Shift"===e.key&&e.stopPropagation()})),n=L.on("key-up",(e=>{"Shift"===e.key&&e.stopPropagation()})),{SketchViewModel:s,GraphicsLayer:i,jsonUtils:r}=R,l=new i;a=new s({view:L,layer:l,pointSymbol:r.fromJSON(q),polylineSymbol:r.fromJSON(W),polygonSymbol:r.fromJSON(H)}),a.viewKeyDownHandle=t,a.viewKeyUpHandle=n,a.on("create",(t=>{if("complete"===t.state&&(o(),he.current)){const o=t.graphic,n=$(Q.current),s=$(K.current);let i=e.DataSourceSelectionMode.New;i=n?s?e.DataSourceSelectionMode.SelectFromCurrent:e.DataSourceSelectionMode.AddToCurrent:s?e.DataSourceSelectionMode.RemoveFromCurrent:e.DataSourceSelectionMode.New,he.current(a.view,o,i)}}))}T.current=a,o()}),[ge,R,L,ye]),e.React.useEffect((()=>{p(A&&re===U)}),[A,re,p]),e.hooks.useUnmount((()=>{const e=T.current;e&&(_(e),T.current=null)}));const be=e.React.useMemo((()=>{let e="";if(re)if(re===U)e="";else{let t="";t=re===m.Point?I("SelectionByPoint"):re===m.Rectangle?I("SelectionByRectangle"):re===m.Polygon?I("SelectionByLasso"):re===m.Circle?I("SelectionByCircle"):re===m.Polyline?I("SelectionByLine"):I("SelectLabel");const a=I("newSelection"),o=I("addToCurrentSelection"),n=I("removeFromCurrentSelection"),s=I("selectFromCurrentSelection"),i=I("drawShape"),r=I("draw"),l=X.current?"Cmd":"Ctrl",c=`∙ ${a} (${i})`;e=Se?`${t}\n${c}\n∙ ${o} (Shift + ${r})\n∙ ${n} (${l} + ${r})\n∙ ${s} (Shift + ${l} + ${r})`:`${t}\n${c}`}return e}),[Se,re,I]),Ie=e.React.useCallback((()=>{Y((e=>!e))}),[Y]),xe=e.React.useCallback((()=>{z(!A)}),[A]),Re=e.React.useCallback((()=>{oe.forEach((e=>{e.clearSelection&&e.clearSelection()}))}),[oe]),Me=me.length>=2;return(0,e.jsx)("div",{className:"w-100 p-4",css:F},(0,e.jsx)("div",{className:(0,e.classNames)(["d-flex align-items-center dropdown-btn-container",{"render-dropdown":Me}])},re&&(0,e.jsx)(t.Button,{className:"selected-tool-btn",icon:!0,disabled:pe(re),type:A?"primary":"default",title:be,onClick:xe},(0,e.jsx)(t.SVG,{src:de})),Me&&(0,e.jsx)(t.Dropdown,{activeIcon:!0,isOpen:J,toggle:Ie},(0,e.jsx)(t.DropdownButton,{className:"select-dropdown-btn",type:J?"primary":"default"}),(0,e.jsx)(t.DropdownMenu,{alignment:"start",offset:[0,4]},me)),ue&&(0,e.jsx)("div",{className:"api-modules-loading-progress"})),(0,e.jsx)(t.Button,{title:I("drawToolClearBtn"),className:"pl-4 pr-4 nowrap clear-all-btn",type:"default",icon:!0,onClick:Re},(0,e.jsx)("span",{className:"nowrap"},I("drawToolClearBtn"))))}function $(e){return!!e&&(!!e.isKeyDown||Date.now()-e.eventDate.getTime()<=500)}function _(e){e&&(e.viewKeyDownHandle&&(e.viewKeyDownHandle.remove(),e.viewKeyDownHandle=null),e.viewKeyUpHandle&&(e.viewKeyUpHandle.remove(),e.viewKeyUpHandle=null),e.destroyed||e.destroy())}var Y=i(75433),Z=i.n(Y);const Q=t=>{const a=window.SVG,{className:o}=t,n=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a}(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:s,src:Z()},n)):e.React.createElement("svg",Object.assign({className:s},n))};var K=i(31670),X=i.n(K);const ee=t=>{const a=window.SVG,{className:o}=t,n=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a}(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:s,src:X()},n)):e.React.createElement("svg",Object.assign({className:s},n))};var te=i(50926),ae=i.n(te);const oe=t=>{const a=window.SVG,{className:o}=t,n=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a}(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:s,src:ae()},n)):e.React.createElement("svg",Object.assign({className:s},n))};var ne=function(e,t,a,o){return new(a||(a=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};class se{constructor(e,t){this.ds=e,this.widgetId=t}clearSelection(){return ne(this,void 0,void 0,(function*(){const e=[];yield this.ds.selectRecords({widgetId:this.widgetId,records:e}),this.publishMessage(e)}))}selectRecords(t,a,o,n,s,i){return ne(this,void 0,void 0,(function*(){Object.values(a).includes(a)&&(a=e.DataSourceSelectionMode.New);let r=null;const l=this.widgetId,c=this.ds;if(a!==e.DataSourceSelectionMode.New||t.objectIds||t.geometry||t.where&&"1=1"!==t.where){const u=yield e.dataSourceUtils.selectBySelectionMode({widgetId:l,ds:c,query:t,selectionMode:a,signal:o,checkLayerVisibility:!1,jimuLayerView:n,progressCallback:s,updateSelectionIfAborted:i});u&&(r=u.records)}else r=[],c.selectRecords({widgetId:l,records:r});r&&this.publishMessage(r)}))}publishMessage(t){const a=new e.DataRecordsSelectionChangeMessage(this.widgetId,t);e.MessageManager.getInstance().publishMessage(a)}}var ie=i(33869),re=i.n(ie);const le=t=>{const a=window.SVG,{className:o}=t,n=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a}(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:s,src:re()},n)):e.React.createElement("svg",Object.assign({className:s},n))};var ce=function(e,t,a,o){return new(a||(a=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};const ue=e.css`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;

  .select-custom-sql-builder-header {
    padding: 16px;
  }

  .raw-sql-expression-builder {
    position: absolute;
    left: 16px;
    right: 16px;
    top: 53px;
    bottom: 16px;
    height: auto !important;
  }
`;function de(a){const{isRTL:o,widgetId:n,widgetDomRef:i,dataSource:r,imSqlExpression:l,onBack:c}=a,u=null==i?void 0:i.current,d=e.hooks.useTranslation(t.defaultMessages,s),[p,m]=e.React.useState(null),[f,g]=e.React.useState(l),S=e.React.useCallback((()=>{c(f)}),[f,c]),y=e.React.useCallback((e=>{g(e)}),[g]);return e.React.useEffect((()=>{!function(){ce(this,void 0,void 0,(function*(){try{const t=yield e.moduleLoader.loadModules(["jimu-ui/advanced/sql-expression-builder"]);t&&t[0].SqlExpressionBuilder&&m(t[0].SqlExpressionBuilder)}catch(e){console.error("load SqlExpressionBuilder error",e)}}))}()}),[]),u?e.ReactDOM.createPortal((0,e.jsx)("div",{className:"select-custom-sql-builder surface-1 border-0",css:ue},(0,e.jsx)("div",{className:"select-custom-sql-builder-header"},(0,e.jsx)(t.Button,{type:"tertiary",size:"sm",icon:!0,onClick:S},(0,e.jsx)(le,{autoFlip:o})),(0,e.jsx)(t.Label,null,d("buildCustomSQL"))),p&&r&&(0,e.jsx)(p,{className:"raw-sql-expression-builder",dataSource:r,mode:e.SqlExpressionMode.Simple,widgetId:n,expression:f,noScrollForList:!0,queryScope:e.QueryScope.InRuntimeView,onChange:y})),u):null}function pe(a){const o="black",n=e.React.useMemo((()=>e.css`
      display: inline-block;
      position: relative;
      width: 20px;
      height: 20px;
      background: transparent;

      .select-circle-progress {
        position: absolute;
        left: 0;
        top: 0;

        .progress-circle-bg {
          stroke: ${o};
          opacity: 0.3;
        }

        .progress-circle-progress {
          stroke: ${o};
          transition: none !important;
        }
      }

      .progress-stop {
        position: absolute;
        width: 6px;
        height: 6px;
        left: 7px;
        top: 7px;
        background: ${o};
      }

      .progress-mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
      }
    `),[o]),i=e.hooks.useTranslation(t.defaultMessages,s),r=100*a.progress,l=parseFloat(r.toFixed(2)),c=i("selectingFeaturesTip");return(0,e.jsx)("div",{css:n,onClick:a.onClick,className:"select-progress",title:c},(0,e.jsx)(t.Progress,{className:"select-circle-progress",color:"light",type:"circular",value:l,circleSize:20}),(0,e.jsx)("div",{className:"progress-stop"}),(0,e.jsx)("div",{className:"progress-mask"}))}var me=function(e,t,a,o){return new(a||(a=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};function fe(a){var o;const{isRTL:n,widgetId:i,widgetDomRef:r,enableDataAction:l,imDataSourceItem:c,itemRuntimeInfo:u,jimuMapView:d,updateDataSourceItemRuntimeInfoForUid:p,onDataRecordSetChange:m}=a,f=c.uid,S=c.useDataSource,y=c.sqlHint||"",v=c.sqlExpression,h=S.dataSourceId,w=c.jimuLayerViewId,D=u.displayTitle,N=u.dataSource,k=u.jimuLayerView,C=u.checked,L=u.imDisplaySqlExpression,E=(null===(o=u.latestSelectTaskInfo)||void 0===o?void 0:o.version)||0,T=u.shouldRenderFilterIcon,O=u.isAttributeFilterOn,A=u.isSelecting,V=u.isGenerated,z=V,P=e.hooks.useTranslation(t.defaultMessages,s),[B,F]=e.React.useState([]),U=B.length,G=e.React.useRef(null),[q,W]=e.React.useState(!1),[H,J]=e.React.useState(!1),$=e.React.useRef(u);$.current=u;const[_,Y]=e.React.useState(0),Z=e.React.useRef(null),K=e.React.useRef(0),X=e.React.useMemo((()=>I(V,v)),[V,v]),te=e.React.useMemo((()=>(V?P("customSQL"):y)||""),[y,V,P]),ae=e.React.useMemo((()=>{var t,a,o,n,s;let i=null;if(N&&B.length>0){const r=N.getLabel()||"",l=P("selectWidgetSelection",{layerName:r});i={dataSource:N,name:l,type:"selected",records:B};let c=!1;const u=N.getInfo&&(null===(a=null===(t=N.getInfo())||void 0===t?void 0:t.selectOptions)||void 0===a?void 0:a.widgetId);if(u){const t=null===(n=null===(o=(0,e.getAppStore)())||void 0===o?void 0:o.getState())||void 0===n?void 0:n.appConfig;if(t&&t.widgets){const e=t.widgets[u],a=null==e?void 0:e.uri;"widgets/arcgis/arcgis-map/"!==a&&"widgets/common/select/"!==a||(c=!0)}}const d=N.getAllUsedFields()||[];let p=[];if(k&&c){const e=k.view;e&&(null===(s=e.availableFields)||void 0===s?void 0:s.length)>0&&(p=e.availableFields.slice())}p||(p=[]);let m=[].concat(d).concat(p);if(m=Array.from(new Set(m)),m.includes("*")){m=m.filter((e=>"*"!==e));const e=N.getSchema();if(null==e?void 0:e.fields){const t=Object.keys(null==e?void 0:e.fields);t.length>0&&(m=t)}}m&&m.length>0&&(i.fields=m)}return i}),[N,k,B,P]),ne=e.React.useMemo((()=>ae?[ae]:[]),[ae]),[ie,re]=e.React.useState(!1),le=e.React.useMemo((()=>{const e=!w,t=R(E);return ie||e||t||T&&q&&X||T&&q&&H}),[H,q,ie,w,E,T,X]),ce=e.React.useCallback((()=>me(this,void 0,void 0,(function*(){let t=N;if(!t){const a=e.DataSourceManager.getInstance();if(t=a.getDataSource(S.dataSourceId),!t)try{t=yield a.createDataSourceByUseDataSource(S)}catch(e){t=null,console.error("create data source error",S.dataSourceId,e)}t&&p(f,{dataSource:t})}return t}))),[N,f,p,S]),ue=e.React.useCallback((()=>{var e,t;let a="";return N&&(a=N.getLabel()||(null===(e=N.getDataSourceJson())||void 0===e?void 0:e.sourceLabel)||""),a||k&&(a=null===(t=k.layer)||void 0===t?void 0:t.title),a||(a=""),a&&a!==D&&p(f,{displayTitle:a}),a}),[N,D,k,f,p]);e.React.useEffect((()=>{ue()}),[ue]),e.React.useEffect((()=>{if(!N){const t=e.DataSourceManager.getInstance().getDataSource(h);t&&p(f,{dataSource:t})}}),[N,h,f,p]),e.React.useEffect((()=>{le&&!N&&ce()}),[N,ce,le]),e.React.useEffect((()=>{if(w&&!k&&d&&0===w.indexOf(d.id)){function e(){return me(this,void 0,void 0,(function*(){let e=null;try{e=yield d.whenJimuLayerViewLoaded(w)}catch(t){e=null,console.error("jimuLayerViewLoaded error",w,t)}if(e){const t=e.isLayerVisible();p(f,{checked:t,jimuLayerView:e})}}))}e()}}),[k,w,d,f,p]),e.React.useEffect((()=>{m(f,ae)}),[ae,m,f]);const fe=e.React.useCallback(((t,a)=>{var o,n,s,r;let l=N;if(a){const c=(null===(o=null==t?void 0:t.selectedIds)||void 0===o?void 0:o.length)>0?null==t?void 0:t.selectedIds:null,u=(null===(n=a.selectedIds)||void 0===n?void 0:n.length)>0?a.selectedIds:null,d=(null===(s=a.selectOptions)||void 0===s?void 0:s.widgetId)||"";if(c!==u&&d!==i){const t=Z.current;if(t){const e=`Select widget: selection changed by other widget ${d}, abort current on-the-fly selecting task`;t.ignoreAbortedSelection=!0,t.abort(e)}const a={isAttributeFilterOn:!1};if(null===(r=$.current)||void 0===r?void 0:r.latestSelectTaskInfo){const t={version:$.current.latestSelectTaskInfo.version,selectionMode:e.DataSourceSelectionMode.New,appliedGeometryInfo:j(null),appliedSql:M("")};a.latestSelectTaskInfo=t}p(f,a)}if(a.instanceStatus!==e.DataSourceStatus.Created&&N)p(f,{dataSource:null});else if(a.instanceStatus===e.DataSourceStatus.Created){const t=e.DataSourceManager.getInstance().getDataSource(h);t&&t!==N&&(l=t,p(f,{dataSource:t}))}}let c=[];l&&(c=l.getSelectedRecords()||[],F(c)),F(c),ue()}),[N,h,i,f,p,ue]),ge=e.React.useRef();ge.current=fe,e.React.useEffect((()=>{let t=null;const a=(0,e.getAppStore)().getState();return a&&a.dataSourcesInfo&&(t=a.dataSourcesInfo[h]),ge.current&&ge.current(t,t),G.current=(0,e.observeStore)(((e,t)=>{ge.current&&ge.current(e,t)}),["dataSourcesInfo",h]),()=>{G.current&&"function"==typeof G.current&&G.current(),G.current=null}}),[h]),e.React.useEffect((()=>{const e=$.current;if(!e)return;if(!N)return;const t=e.latestSelectTaskInfo;if(!t)return;const a=t.version;if(!R(a))return;if(a<=K.current)return;Y(0),Z.current&&(Z.current.abort(`cancel selecting task ${K.current} because need to execute a new one`),Z.current=null);const o=a;K.current=o;const n=new AbortController;n.selectVersion=o,Z.current=n;const s=n.signal;let r=null;e.imDisplaySqlExpression&&(r=e.imDisplaySqlExpression.asMutable());const l={returnGeometry:!0,sqlExpression:r},c=t.appliedSql;c&&(l.where=c);const u=t.appliedGeometryInfo;u&&(l.geometry=u.geometry,l.geometryType=u.geometryType,l.spatialRel=u.spatialRel);const d=t.selectionMode,m=()=>$.current&&$.current.latestSelectTaskInfo.version===o,g=e=>{m()&&Y(e)},S=new se(N,i),y=()=>{var e;const t=m(),a=null===(e=Z.current)||void 0===e?void 0:e.ignoreAbortedSelection;return t&&!a};!function(){me(this,void 0,void 0,(function*(){try{yield S.selectRecords(l,d,s,k,g,y)}catch(e){console.error("Select widget select records error",e)}Z.current&&Z.current.selectVersion===o&&(Z.current=null),m()&&(p(f,{isSelecting:!1}),Y(1))}))}()}),[E,N,k,f,p,i]),e.React.useEffect((()=>{const e=b(V,v);p(f,{shouldRenderFilterIcon:e,imDisplaySqlExpression:v})}),[V,v,f,p]);const Se=e.React.useCallback(((e,t)=>me(this,void 0,void 0,(function*(){const a=$.current;if(!a)return;let o=a.dataSource;if(o||(o=yield ce()),!o)return;t=j(t);const n=x(a.isAttributeFilterOn,a.imDisplaySqlExpression,o),s=a.latestSelectTaskInfo;if(s.version>0){const a=e===s.selectionMode,o=t===s.appliedGeometryInfo,i=n===s.appliedSql;if(a&&o&&i)return}const i=s.version+1;p(f,{latestSelectTaskInfo:{version:i,selectionMode:e,appliedGeometryInfo:t,appliedSql:n},isSelecting:!0})}))),[ce,f,p]),ye=e.React.useRef();ye.current=Se;const ve=e.React.useCallback((e=>{e=!!e,T&&p(f,{isAttributeFilterOn:e})}),[T,f,p]),he=e.React.useCallback((()=>me(this,void 0,void 0,(function*(){let t=N;if(t||(t=yield ce()),!t)return;new se(t,i).clearSelection();const a=$.current.latestSelectTaskInfo.version+1,o=j(null),n=M(""),s={version:a,selectionMode:e.DataSourceSelectionMode.New,appliedGeometryInfo:o,appliedSql:n};p(f,{latestSelectTaskInfo:s,isAttributeFilterOn:!1,isSelecting:!0})}))),[N,ce,f,p,i]),we=e.React.useRef(!0);e.React.useEffect((()=>{const t=$.current;if(!t)return;const a=we.current;if(we.current=!1,!N&&!a)return void re(!0);const o=t.latestSelectTaskInfo;x(O,L,N)!==o.appliedSql&&ye.current&&ye.current(e.DataSourceSelectionMode.New,o.appliedGeometryInfo)}),[N,L,O]),e.React.useEffect((()=>{p(f,{tryExecuteSelectingByGeometryInfoAndSqlUI:Se})}),[Se,f,p]),e.React.useEffect((()=>{p(f,{enableAttributeFilter:ve})}),[ve,f,p]),e.React.useEffect((()=>{p(f,{clearSelection:he})}),[he,f,p]);const be=e.React.useCallback(((e,t)=>{p(f,{checked:t})}),[p,f]),Ie=e.React.useCallback((()=>{W(!q)}),[W,q]),xe=e.React.useCallback((()=>{he()}),[he]),Re=e.React.useCallback((()=>{const e=Z.current;e&&e.abort()}),[Z]),Me=e.React.useCallback((()=>{J(!0)}),[J]),je=e.React.useCallback(((e,t)=>{ve(t)}),[ve]),De=e.React.useCallback((e=>{const t=b(V,e);p(f,{shouldRenderFilterIcon:t,imDisplaySqlExpression:e})}),[V,p,f]),Ne=e.React.useCallback((e=>{De(e),J(!1)}),[De,J]),ke=e.React.useMemo((()=>{let t=38;T&&(t+=26),l&&(t+=26);const a=`${t}px`;let o=4;o+=A?20:4+10*U.toString().length+4;const n=`${o}px`;return e.css`
    .select-ds-list-item-top-row {
      position: relative;

      .ds-list-label-container {
        width: calc(100% - ${a});
        flex-basis: calc(100% - ${a});
        flex-shrink: 0;
        flex-grow: 0;

        .ds-list-label {
          max-width: calc(100% - ${n});
          flex-basis: auto;
          flex-shrink: 0;
          flex-grow: 0;

          .layer-name {
            width: calc(100% - 20px);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
          }
        }

        .selection-count-container {
          width: ${n};
          flex-basis: ${n};
          flex-shrink: 0;
          flex-grow: 0;

          .selection-count {
            display: inline;
            border-radius: 4px;
            background: var(--light-200);
            padding: 1px 4px 0px 4px;
            line-height: 16px;
            font-size: 12px;
          }
        }
      }
  
      .ds-list-icons {
        box-sizing: border-box;
        flex-direction: row-reverse;
        width: ${a};
        flex-basis: ${a};
        flex-shrink: 0;
        flex-grow: 0;
      }
    }

    .select-sql-hint {
      word-break: break-all;
    }
    
    .sql-expr-runtime-disabled {
      touch-action: none;
      pointer-events: none;
    }
  `}),[l,A,U,T]);return D?(0,e.jsx)("div",{className:(0,e.classNames)(["select-ds-list-item w-100 mt-2",{"filer-panel-opened":q}]),css:ke},(0,e.jsx)("div",{className:"select-ds-list-item-top-row w-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"ds-list-label-container d-flex align-items-center"},(0,e.jsx)(t.Label,{className:"ds-list-label d-flex align-items-center mb-0"},(0,e.jsx)(t.Checkbox,{checked:C,className:"mr-1",onChange:be}),(0,e.jsx)("span",{className:"layer-name",title:D},D)),(0,e.jsx)("div",{className:"selection-count-container d-flex align-items-center pl-1"},!A&&U>0&&(0,e.jsx)("div",{className:"selection-count"},U),A&&(0,e.jsx)(pe,{progress:_,onClick:Re}))),(0,e.jsx)("div",{className:"ds-list-icons d-flex align-items-center"},l&&(0,e.jsx)(t.DataActionList,{widgetId:i,dataSets:ne,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:t.DataActionListStyle.Dropdown,hideGroupTitle:!0}),(0,e.jsx)(t.Button,{title:P("clearSelection"),type:"tertiary",size:"sm",icon:!0,onClick:xe},(0,e.jsx)(ee,{size:16})),T&&(0,e.jsx)(t.Button,{title:P("attributeSelection"),type:q?"primary":"tertiary",size:"sm",icon:!0,onClick:Ie},(0,e.jsx)(oe,{width:16,height:16})))),T&&(0,e.jsx)("div",{className:(0,e.classNames)(["filter-panel w-100",{"d-none":!q}])},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center mt-3"},(0,e.jsx)("label",{className:"w-100 pb-0 pr-1 select-sql-hint"},te),z&&(0,e.jsx)(t.Button,{title:P("customSQL"),type:"tertiary",size:"sm",icon:!0,onClick:Me},(0,e.jsx)(Q,null)),(0,e.jsx)(t.Switch,{disabled:A,checked:O,onChange:je})),X&&N&&(0,e.jsx)(g.SqlExpressionRuntime,{className:(0,e.classNames)([{"sql-expr-runtime-disabled":A}]),widgetId:i,dataSource:N,expression:L,onChange:De}),H&&N&&(0,e.jsx)(de,{isRTL:n,widgetId:i,widgetDomRef:r,dataSource:N,imSqlExpression:L,onBack:Ne}))):null}var ge=i(92912),Se=i.n(ge);const ye=t=>{const a=window.SVG,{className:o}=t,n=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a}(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:s,src:Se()},n)):e.React.createElement("svg",Object.assign({className:s},n))};function ve(a){const{isRTL:o,widgetId:n,widgetDomRef:i,jimuMapView:r,enableDataAction:l,allImDataSourceItems:c,generatedImDataSourceItems:u,configDataSourceItems:d,dataSourceItemRuntimeInfoMap:p,updateDataSourceItemRuntimeInfoForUid:m}=a,f=e.hooks.useTranslation(t.defaultMessages,s),[g,S]=e.React.useState(!1),[y,v]=e.React.useState({}),w=e.React.useRef(null),b=e.React.useMemo((()=>function(e,t){const a=[];return e.forEach((e=>{const o=e.uid,n=t[o];n&&a.push(n)})),a}(c,p)),[p,c]),I=e.React.useCallback((()=>{S((e=>!e))}),[S]),x=e.React.useCallback((()=>{S(!1)}),[S]),R=e.React.useCallback((()=>{S(!1),b.forEach((e=>{e.checked||m(e.uid,{checked:!0})}))}),[b,m]),M=e.React.useCallback((()=>{S(!1),b.forEach((e=>{e.checked&&m(e.uid,{checked:!1})}))}),[b,m]),j=e.React.useCallback((()=>{S(!1),b.forEach((e=>{m(e.uid,{checked:!e.checked})}))}),[b,m]),D=e.React.useCallback(((e,t)=>{v((a=>Object.assign({},a,{[e]:t})))}),[v]),N=e.React.useCallback((e=>e.filter((e=>{const t=e.uid;return!!p[t]}))),[p]),k=e.React.useMemo((()=>N(u)),[u,N]),C=e.React.useMemo((()=>N(d)),[d,N]),L=e.React.useMemo((()=>{const e=h(c,p),t={};e.forEach((e=>{const a=null==e?void 0:e.uid;a&&(t[a]=!0)}));const a=[];return Object.keys(y).forEach((e=>{if(t[e]){const t=y[e];t&&a.push(t)}})),a}),[c,p,y]),E=e.React.useMemo((()=>e.css`
      .layers-header-tip {
        font-size: 0.875rem;
        color: var(--dark-800);
        font-weight: 600;
      }
    `),[]);return(0,e.jsx)("div",{className:"data-attribute-select p-4",css:E},(0,e.jsx)("div",{className:"w-100 d-flex align-items-center"},(0,e.jsx)(t.Button,{className:"pl-0 pr-2",type:"tertiary",size:"sm",icon:!0,ref:w,onClick:I},(0,e.jsx)(ye,{width:16,height:16})),(0,e.jsx)(t.Label,{className:"layers-header-tip mb-0 w-100"}," ",f("layers")," "),l&&(0,e.jsx)(t.DataActionList,{widgetId:n,dataSets:L,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:t.DataActionListStyle.Dropdown,hideGroupTitle:!0,alwaysShowBatchIcon:!0})),(0,e.jsx)("div",{className:"ds-list-items"},k.map((t=>{const a=t.uid,s=p[a];return(0,e.jsx)(fe,{key:a,isRTL:o,widgetId:n,widgetDomRef:i,jimuMapView:r,enableDataAction:l,imDataSourceItem:t,itemRuntimeInfo:s,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:D})}))),(0,e.jsx)("div",{className:"ds-list-items"},C.map((t=>{const a=t.uid,s=p[a];return(0,e.jsx)(fe,{key:a,isRTL:o,widgetId:n,widgetDomRef:i,jimuMapView:r,enableDataAction:l,imDataSourceItem:t,itemRuntimeInfo:s,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:D})}))),(0,e.jsx)(t.Popper,{reference:w,floating:!1,open:g,showArrow:!1,toggle:x},(0,e.jsx)("div",{className:"d-flex flex-column"},(0,e.jsx)(t.Button,{type:"tertiary",className:"text-left",onClick:R},f("allSelectable")),(0,e.jsx)(t.Button,{type:"tertiary",className:"text-left",onClick:M},f("noneSelectable")),(0,e.jsx)(t.Button,{type:"tertiary",className:"text-left",onClick:j},f("toggleAll")))))}var he=i(26826),we=function(e,t,a,o){return new(a||(a=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};function be(a){const{widgetId:o,visible:i,allImDataSourceItems:r,dataSourceItemRuntimeInfoMap:l,imSpatialSelection:m,updateDataSourceItemRuntimeInfoForUid:f}=a,g=m.buffer;let S=!1,y=0,v=null;g&&(S=g.enable,y=g.distance,v=g.unit),"number"!=typeof y&&(y=0),v||(v=d.Meters);const[b,I]=e.React.useState({}),[x,R]=e.React.useState(m.relationships&&m.relationships[0]),[M,j]=e.React.useState(""),[D,N]=e.React.useState(y),[k,C]=e.React.useState(v),[L,E]=e.React.useState(-1),[T,O]=e.React.useState(!1),A=e.React.useRef([]),V=e.hooks.useTranslation(t.defaultMessages,s);e.React.useEffect((()=>{"number"==typeof y&&N(y)}),[y]),e.React.useEffect((()=>{v&&C(v)}),[v]);const z=e.React.useMemo((()=>e.css`
      border-bottom: 1px solid var(--light-300);

      .select-by-location-title {
        font-size: 0.875rem;
        color: var(--dark-800);
        font-weight: 600;
      }

      .select-by-location-param-title {
        font-weight: 500;
      }

      .feature-count-info {
        background: var(--primary-100, #E6F2FF);
        border-color: var(--info-300, #60CEFF);
        border-width: 1px;
        border-style: solid;
        min-height: 32px;
      }
    `),[]),P=e.React.useMemo((()=>M?b[M]||e.DataSourceManager.getInstance().getDataSource(M):null),[b,M]),B=e.React.useMemo((()=>{let e=null;return P&&(e=P.getMainDataSource()),e}),[P]),F=e.React.useMemo((()=>h(r,l).length),[r,l]),U=e.React.useMemo((()=>w(r,l)),[r,l]),G=U.length,q=e.React.useMemo((()=>{let e=x&&P&&!T&&F>0&&F===G;return e=!!e,e}),[T,F,G,x,P]),W=e.React.useCallback((()=>{A.current=U;const e=A.current||[];O(!0),e.forEach((e=>{const t=e.uid;f(t,{isSelecting:!0})}))}),[A,U,f]),H=e.React.useCallback((t=>{const a=A.current||[];A.current=[],O(!1),a.forEach((a=>we(this,void 0,void 0,(function*(){a.tryExecuteSelectingByGeometryInfoAndSqlUI(e.DataSourceSelectionMode.New,t)}))))}),[A,O]),J=e.React.useCallback((()=>{const e=A.current||[];A.current=[],O(!1),e.forEach((e=>{const t=e.uid;f(t,{isSelecting:!1})}))}),[A,O,f]),$=e.React.useCallback((()=>{if(!x)return;if(!P)return;W();const t=function(e,t,a,o){return we(this,void 0,void 0,(function*(){const n=yield e.ds.queryAll({outFields:[],returnGeometry:!0,outSpatialReference:{latestWkid:3857,wkid:102100}}),s=yield(0,he.loadArcGISJSAPIModules)(["esri/geometry/support/jsonUtils","esri/geometry/geometryEngineAsync"]),[i,r]=s,l=[];n&&n.records.length>0&&n.records.forEach((e=>{const t=e.getGeometry();if(t)if(t.declaredClass)l.push(t);else{const e=i.fromJSON(t);l.push(e)}}));let c=null;if(l.length>0)if(t&&a>0&&o){const e=p[o],t=!0,n=yield r.buffer(l,[a],e,t);c=Array.isArray(n)?n[0]:n}else c=1===l.length?l[0]:yield r.union(l);return c}))}(new se(P,o),S,D,k);t.then((t=>{const a=e.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(t.type),o=c[x],n={geometry:t.toJSON(),geometryType:a,spatialRel:o};H(n)})).catch((e=>{console.error("can not get buffered union geometry",e),J()}))}),[D,k,S,J,H,W,x,P,o]);e.React.useEffect((()=>{E(-1),P&&P.queryCount({}).then((e=>{if(P.id===M){const t=(null==e?void 0:e.count)||0;E(t)}})).catch((e=>{console.error("query count error for location data source",e)}))}),[P,M]);const _=e.React.useCallback((e=>{if(P&&P.id===M&&Ie(P)){const t=(null==e?void 0:e.length)||0;E(t)}}),[P,M]),Y=e.React.useCallback((e=>{const t=e.target.value;R(t)}),[R]),Z=e.React.useCallback((e=>{const t=e.target.value;j(t)}),[j]),Q=e.React.useCallback((e=>{e&&I((t=>{const a=e.id;return Object.assign({},t,{[a]:e})}))}),[I]),K=e.React.useCallback((e=>{N(e)}),[N]),X=e.React.useCallback((e=>{const t=e.target.value;C(t)}),[C]),ee=e.React.useMemo((()=>{const e=[];return m.useDataSources.forEach((t=>{const a=t.dataSourceId,o=b[a];o&&e.push(o)})),e}),[b,m.useDataSources]),te=V("selectByData"),ae=V("apply"),oe=V("relationship"),ne=V("selectingFeatures"),ie=V("theBufferDistance"),re=V("bufferUnit"),le=V("selectByLocationFeatureCountTip",{count:L});return(0,e.jsx)("div",{className:(0,e.classNames)(["select-by-location p-4",{"d-none":!i}]),css:z},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-title w-100 mb-0",title:te},te),(0,e.jsx)(t.Button,{className:"nowrap",type:"primary",disabled:!q,size:"sm",onClick:$},ae)),(0,e.jsx)("div",{className:"relationship-param w-100 d-flex flex-column align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:oe},oe),(0,e.jsx)(t.Select,{className:"relationship-select w-100",size:"sm",value:x,"aria-label":oe,onChange:Y},m.relationships.map((t=>(0,e.jsx)("option",{key:t,value:t},V(u[t])))))),(0,e.jsx)("div",{className:"data-view-param w-100 d-flex flex-column align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:ne},ne),(0,e.jsx)(t.Select,{className:"selecting-features-select w-100",size:"sm",value:M,"aria-label":ne,onChange:Z},ee.map((t=>(0,e.jsx)("option",{key:t.id,value:t.id},t.getLabel()||"")))),m.useDataSources.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,useDataSource:t,onDataSourceCreated:Q})))),P&&B&&Ie(P)&&(0,e.jsx)(e.DataSourceComponent,{dataSource:B,onSelectionChange:_}),S&&(0,e.jsx)("div",{className:"distance-unit-param w-100 d-flex flex-column align-items-center"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:ie},ie),(0,e.jsx)("div",{className:"d-flex w-100 justify-content-between"},(0,e.jsx)(t.NumericInput,{className:"distance-input w-45 mr-1","aria-label":ie,size:"sm",value:D,min:0,onChange:K}),(0,e.jsx)(t.Select,{className:"unit-select w-55",size:"sm",value:k,"aria-label":re,onChange:X},Object.values(d).map((t=>(0,e.jsx)("option",{key:t,value:t},V(`unit_${t}`))))))),L>=0&&(0,e.jsx)("div",{className:"feature-count-info p-2 mt-3"},(0,e.jsx)(n,{color:"var(--info-600, #0077AC)"}),(0,e.jsx)("span",{className:"pl-2","aria-label":le},le)))}function Ie(t){return!!t&&t.isDataView&&t.dataViewId===e.CONSTANTS.SELECTION_DATA_VIEW_ID}function xe(t){const{isRTL:a,className:o,widgetProps:n,widgetDomRef:s,dataSourceItemRuntimeInfoMap:i,mixinDataSourceItemRuntimeInfoMap:r,updateDataSourceItemRuntimeInfoForUid:l,updateWidgetDisplayMode:c}=t,{widgetId:u,config:d,dataSourceCount:p,autoControlWidgetId:m}=n,{dataAttributeInfo:g,spatialSelection:h}=d,{allowGenerated:w,dataSourceItems:b}=g,I=!1!==n.enableDataAction,x=!!(null==h?void 0:h.enable),[R,M]=e.React.useState(!1),[j,D]=e.React.useState((0,e.Immutable)([])),N=e.React.useMemo((()=>j.concat(b)),[b,j]);e.React.useEffect((()=>{let e=null;e=N.length>0?v(N,i).length>0?f.Normal:f.Loading:f.Placeholder,c(e)}),[N,i,c]),e.React.useEffect((()=>{if(!w)return void(0!==j.length&&D((0,e.Immutable)([])));const t=(0,e.getAppStore)().getState().dataSourcesInfo||(0,e.Immutable)({}),a=e.DataSourceManager.getInstance(),o=j.map((e=>e.useDataSource.dataSourceId)).asMutable(),n=[];Object.keys(t).forEach((t=>{if(t.includes("view_in_table"))return;if(t.includes("associated_data_source"))return;const o=a.getDataSource(t);o&&(o.isInAppConfig()||o.isDataView||o.isLocal||o.type!==e.DataSourceTypes.FeatureLayer&&o.type!==e.DataSourceTypes.SceneLayer||n.push(o.id))}));const{added:s,deleted:l,saved:c}=e.utils.diffArrays(!0,o,n);if(0===s.length&&0===l.length)return;const u=j.filter((e=>{const t=e.useDataSource.dataSourceId;return c.includes(t)})),d=[];if(s.length>0){s.forEach((e=>{const t=a.getDataSource(e);if(t){const e=y(t);d.push(e)}}));const e=S(!1,!0,d,i);r(e)}const p=u.concat(d);D(p)}),[p,w,j,r,D,i]),e.React.useEffect((()=>{const e=b.filter((e=>{const t=e.uid;return!i[t]}));if(e.length>0){const t=S(!1,!1,e,i);r(t)}}),[b,i,r]);const k=["select-use-data-source-entry"];o&&k.push(o);const C=k.join(" ");return e.React.createElement("div",{className:C},e.React.createElement(J,{config:d,widgetId:u,mapWidgetId:"",autoControlWidgetId:m,activeJimuMapView:null,setSelectByLoactionVisible:M,allImDataSourceItems:N,dataSourceItemRuntimeInfoMap:i}),x&&e.React.createElement(be,{widgetId:u,visible:R,allImDataSourceItems:N,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:h,updateDataSourceItemRuntimeInfoForUid:l}),e.React.createElement(ve,{isRTL:a,widgetId:u,widgetDomRef:s,jimuMapView:null,enableDataAction:I,allImDataSourceItems:N,generatedImDataSourceItems:j,configDataSourceItems:b,dataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:l}))}function Re(t){const{isRTL:a,className:o,widgetProps:n,widgetDomRef:s,dataSourceItemRuntimeInfoMap:i,mixinDataSourceItemRuntimeInfoMap:r,updateDataSourceItemRuntimeInfoForUid:l,updateWidgetDisplayMode:c}=t,{widgetId:u,config:d,dataSourceCount:p,mapWidgetId:m,autoControlWidgetId:g}=n,{mapInfo:h,spatialSelection:w}=d,b=!1!==n.enableDataAction,I=!!(null==w?void 0:w.enable),x=h.jimuMapViews,R=!!h.allowGenerated,[M,j]=e.React.useState(!1),D=e.React.useRef(R);D.current=R;const N=e.hooks.usePrevious(R),[k,C]=e.React.useState(null),L=e.hooks.usePrevious(k),E=k?k.id:"",[T,O]=e.React.useState((0,e.Immutable)([])),A=e.React.useRef(),V=e.React.useCallback((()=>{if(!R||!k)return void(0!==T.length&&O((0,e.Immutable)([])));const t=e.DataSourceManager.getInstance(),a=T.map((e=>e.useDataSource.dataSourceId)).asMutable(),o=[];Me(k).forEach((t=>{const a=t.getLayerDataSource();!a||a.type!==e.DataSourceTypes.FeatureLayer&&a.type!==e.DataSourceTypes.SceneLayer||o.push(a.id)}));const{added:n,deleted:s,saved:l}=e.utils.diffArrays(!0,a,o);if(0===n.length&&0===s.length)return;const c=T.filter((e=>{const t=e.useDataSource.dataSourceId;return l.includes(t)})),u=[];if(n.length>0){n.forEach((e=>{const a=t.getDataSource(e);if(a){const e=k.getJimuLayerViewByDataSourceId(a.id),t=y(a,null==e?void 0:e.id);u.push(t)}}));const e=S(!0,!0,u,i);r(e)}const d=c.concat(u);O(d)}),[k,R,i,T,r]);A.current=V,e.React.useEffect((()=>{N!==R&&A.current&&A.current()}),[N,R,A]),e.React.useEffect((()=>{var t,a;if(L!==k){const e=Me(k).map((e=>{const t=e.getLayerDataSource();return t?Promise.resolve(t):e.createLayerDataSource()}));Promise.all(e).finally((()=>{A.current&&A.current()}))}const o=t=>{return a=this,o=void 0,s=function*(){if(D.current&&t&&je(t)&&De(t)){let a=t.getLayerDataSource();if(!a)try{a=yield t.createLayerDataSource()}catch(e){console.error(`fail to create data source for JimuMapView ${t.id}`,e)}a&&(a.type===e.DataSourceTypes.FeatureLayer||a.type===e.DataSourceTypes.SceneLayer)&&A.current&&A.current()}},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var a;t.done?e(t.value):(a=t.value,a instanceof n?a:new n((function(e){e(a)}))).then(i,r)}l((s=s.apply(a,o||[])).next())}));var a,o,n,s};let n=null;if(k){k.addJimuLayerViewCreatedListener(o);const e=null===(a=null===(t=k.view)||void 0===t?void 0:t.map)||void 0===a?void 0:a.layers;e&&(n=e.on("after-remove",(e=>{const t=e.item;if(t){const e=k.getJimuLayerViewByAPILayer(t);e&&e.fromRuntime&&A.current&&A.current()}})))}return()=>{k&&k.removeJimuLayerViewCreatedListener(o),n&&(n.remove(),n=null)}}),[L,k,A]),e.React.useEffect((()=>{A.current&&A.current()}),[p]);const z=e.React.useMemo((()=>{let t=null;if(x&&E){const e=x[E];e&&e.length>0&&(t=e)}return t||(t=(0,e.Immutable)([])),t}),[E,x]),P=e.React.useMemo((()=>T.concat(z)),[z,T]);e.React.useEffect((()=>{let e=null;if(m){let t=0;x&&Object.values(x).forEach((e=>{e&&e.length>0&&(t+=e.length)})),e=0===T.length&&0===t?f.NoLayersTip:E?P.length>0?v(P,i).length>0?f.Normal:f.Loading:f.NoLayersTip:f.Loading}else e=f.Placeholder;c(e)}),[E,P,i,T.length,x,c,m]),e.React.useEffect((()=>{const e=z.filter((e=>{const t=e.uid;return!i[t]}));if(e.length>0){const t=S(!0,!1,e,i);r(t)}}),[z,i,r]);const B=e.React.useCallback((e=>{C(e)}),[C]),F=["select-use-map-entry"];o&&F.push(o);const U=F.join(" ");return e.React.createElement("div",{className:U},m&&e.React.createElement(he.JimuMapViewComponent,{useMapWidgetId:m,onActiveViewChange:B}),e.React.createElement(J,{config:d,widgetId:u,mapWidgetId:m,autoControlWidgetId:g,activeJimuMapView:k,setSelectByLoactionVisible:j,allImDataSourceItems:P,dataSourceItemRuntimeInfoMap:i}),I&&e.React.createElement(be,{widgetId:u,visible:M,allImDataSourceItems:P,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:w,updateDataSourceItemRuntimeInfoForUid:l}),e.React.createElement(ve,{isRTL:a,widgetId:u,widgetDomRef:s,jimuMapView:k,enableDataAction:b,allImDataSourceItems:P,generatedImDataSourceItems:T,configDataSourceItems:z,dataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:l}))}function Me(e){const t=[];return e&&Object.values(e.jimuLayerViews).forEach((e=>{e&&je(e)&&De(e)&&t.push(e)})),t}function je(e){return!(!e||!e.fromRuntime||e.type!==he.LayerTypes.FeatureLayer&&e.type!==he.LayerTypes.SceneLayer)}function De(e){var t,a,o;if(e){const n=e.getJimuMapView(),s=(null===(o=null===(a=null===(t=null==n?void 0:n.view)||void 0===t?void 0:t.map)||void 0===a?void 0:a.layers)||void 0===o?void 0:o.toArray())||[],i=function(e){let t=null;if(e){const a=e.getJimuMapView();if(a){const o=a.getParentJimuLayerViews(e.id);t=o.length>0?o[o.length-1]:e}}return t}(e),r=null==i?void 0:i.layer;if((null==s?void 0:s.length)>0&&r)return s.includes(r)}return!1}var Ne=i(88970),ke=i.n(Ne);const Ce=e.css`
  position: relative;
  overflow-x: hidden;
  overflow-y: auto;

  .nowrap {
    white-space: nowrap;
    text-wrap: nowrap;
  }

  .no-layers-panel-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding-left: 50px;
    padding-right: 50px;
  }
`,Le=a=>{var o;const{isRTL:i,widgetId:r,config:l}=a,{useMap:c,dataAttributeInfo:u,mapInfo:d}=l,p=e.hooks.useTranslation(t.defaultMessages,s),m=e.React.useRef(),[g,S]=e.React.useState(f.Placeholder),y=e.React.useRef(g);y.current=g;const v=e.React.useRef(!1),h=e.React.useRef(null),[w,b]=e.React.useState({}),I=e.React.useCallback((e=>{if(e!==y.current){if(e===f.Loading){if(v.current)return;v.current=!0,h.current||(h.current=setTimeout((()=>{y.current===f.Loading&&S(f.NoLayersTip)}),2e4))}S(e)}}),[]);e.React.useEffect((()=>()=>{h.current&&clearTimeout(h.current)}),[]);const x=e.React.useCallback((e=>{e&&0!==Object.keys(e).length&&b((t=>Object.assign({},t,e)))}),[b]),R=e.React.useCallback(((e,t)=>{b((a=>{const o=a[e];if(!o)return;const n=Object.assign({},o,t),s=Object.assign({},a);return s[e]=n,s}))}),[b]),M=e.React.useMemo((()=>{var e;let t=[];return c?d&&d.jimuMapViews&&Object.keys(d.jimuMapViews).forEach((e=>{const a=d.jimuMapViews[e];a&&a.length>0&&a.forEach((e=>{const a=e.uid;a&&t.push(a)}))})):u&&(null===(e=u.dataSourceItems)||void 0===e?void 0:e.length)>0&&u.dataSourceItems.forEach((e=>{const a=e.uid;a&&t.push(a)})),t=Array.from(new Set(t)),t}),[c,d,u]),j=e.hooks.usePrevious(M)||[],{deleted:D}=e.utils.diffArrays(!0,j,M);e.React.useEffect((()=>{D&&D.length>0&&b((e=>{const t=Object.assign({},e);let a=!1;return D.forEach((e=>{t[e]&&(delete t[e],a=!0)})),a?t:e}))}),[D]);const N=g!==f.Placeholder,k=(0,e.classNames)(["jimu-widget widget-select border-0"],{"surface-1":N});return(0,e.jsx)("div",{ref:m,className:k,css:Ce},!c&&(0,e.jsx)(xe,{isRTL:i,className:g===f.Normal?"":"d-none",widgetProps:a,widgetDomRef:m,dataSourceItemRuntimeInfoMap:w,mixinDataSourceItemRuntimeInfoMap:x,updateDataSourceItemRuntimeInfoForUid:R,updateWidgetDisplayMode:I}),c&&(0,e.jsx)(Re,{isRTL:i,className:g===f.Normal?"":"d-none",widgetProps:a,widgetDomRef:m,dataSourceItemRuntimeInfoMap:w,mixinDataSourceItemRuntimeInfoMap:x,updateDataSourceItemRuntimeInfoForUid:R,updateWidgetDisplayMode:I}),g===f.NoLayersTip&&(0,e.jsx)("div",{className:"no-layers-panel w-100 h-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"no-layers-panel-content w-100 h-100"},(0,e.jsx)(n,{width:24,height:24}),(0,e.jsx)("div",{className:"mt-2 mb-2"},p("noLayersAvailableTip")),(null===(o=window.jimuConfig)||void 0===o?void 0:o.isInBuilder)&&(0,e.jsx)("div",null,p("openSettingPanelTip")))),g===f.Loading&&(0,e.jsx)(t.Loading,{type:"SECONDARY"}),g===f.Placeholder&&(0,e.jsx)(t.WidgetPlaceholder,{widgetId:r,icon:ke(),message:p("_widgetLabel")}))};Le.mapExtraStateProps=(e,t)=>{var a,o;let n=!1,s=0,i="",r="";const l=function(e,t){var a,o,n;if(e&&!e.useMap&&(null===(o=null===(a=e.dataAttributeInfo)||void 0===a?void 0:a.dataSourceItems)||void 0===o?void 0:o.length)>0){const a=null===(n=e.dataAttributeInfo)||void 0===n?void 0:n.dataSourceItems,o=function(e,t){let a=e;if(e&&e.length>0){const o=[];t&&t.length>0&&t.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&o.push(t)}));let n=!1;const s=e.filter((e=>{const t=null==e?void 0:e.useDataSource,a=null==t?void 0:t.dataSourceId,s=a&&o.includes(a);return s||(n=!0),s}));a=n?s:e}return a||(a=e),a}(a,t);o&&o!==a&&(e=e.setIn(["dataAttributeInfo","dataSourceItems"],o))}return e}(t.config,t.useDataSources)||t.config;(null===(a=e.appContext)||void 0===a?void 0:a.isRTL)&&(n=!0),e.dataSourcesInfo&&(s=Object.keys(e.dataSourcesInfo).length);const c=t.useMapWidgetIds;return c&&c.length>0&&(i=c[0]),e.mapWidgetsInfo&&i&&(r=(null===(o=e.mapWidgetsInfo[i])||void 0===o?void 0:o.autoControlWidgetId)||""),{isRTL:n,dataSourceCount:s,mapWidgetId:i,autoControlWidgetId:r,config:l}};const Ee=Le;function Te(e){i.p=e}})(),r})())}}}));